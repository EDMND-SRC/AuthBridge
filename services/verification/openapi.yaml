openapi: 3.0.3
info:
  title: AuthBridge Verification API
  description: |
    Complete API for AuthBridge KYC/AML verification platform.

    ## Authentication

    AuthBridge supports two authentication methods:

    ### API Key Authentication (Recommended for Server-to-Server)
    Include your API key in the Authorization header:
    ```
    Authorization: Bearer ab_live_1234567890abcdef1234567890abcdef
    ```

    API keys can be created and managed via the Backoffice dashboard or API key management endpoints.

    ### JWT Token Authentication (For Backoffice UI)
    Include your JWT token in the Authorization header:
    ```
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```

    JWT tokens are obtained via the authentication flow in the Backoffice.

    ## Rate Limits
    - Default: 50 requests/second per API key
    - Burst: 100 concurrent requests
    - Custom limits available on request

    Rate limit headers are included in all responses:
    - `X-RateLimit-Limit`: Maximum requests per window
    - `X-RateLimit-Remaining`: Requests remaining in current window
    - `X-RateLimit-Reset`: Unix timestamp when the window resets

    When rate limit is exceeded, you'll receive a `429 Too Many Requests` response with a `Retry-After` header.

    ## File Requirements
    - Maximum file size: 10MB
    - Supported formats: JPEG, PNG, PDF
    - Minimum image dimensions: 640x480 pixels
  version: 2.0.0
  contact:
    name: AuthBridge API Support
    email: api@authbridge.io

servers:
  - url: https://api.authbridge.io
    description: Production
  - url: https://api-staging.authbridge.io
    description: Staging

security:
  - apiKeyAuth: []
  - bearerAuth: []

paths:
  /api/v1/verifications:
    post:
      summary: Create Verification
      description: |
        Create a new verification case for KYC processing.
        Returns a session token and SDK URL for document capture.
      operationId: createVerification
      tags:
        - Verifications
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVerificationRequest'
      responses:
        '201':
          description: Verification created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateVerificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases:
    get:
      summary: List Cases
      description: |
        List verification cases with filtering and pagination.
        Supports filtering by status, date range, and search.
      operationId: listCases
      tags:
        - Cases
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, approved, rejected, expired]
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
        - name: search
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: cursor
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Cases retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListCasesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/{caseId}:
    get:
      summary: Get Case
      description: Get detailed information about a specific case.
      operationId: getCase
      tags:
        - Cases
      security:
        - bearerAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Case retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaseDetails'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/{caseId}/approve:
    post:
      summary: Approve Case
      description: Approve a verification case after review.
      operationId: approveCase
      tags:
        - Cases
      security:
        - bearerAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApproveRequest'
      responses:
        '200':
          description: Case approved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaseActionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Case already processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/{caseId}/reject:
    post:
      summary: Reject Case
      description: Reject a verification case with reason.
      operationId: rejectCase
      tags:
        - Cases
      security:
        - bearerAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectRequest'
      responses:
        '200':
          description: Case rejected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaseActionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Case already processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/bulk-approve:
    post:
      summary: Bulk Approve Cases
      description: |
        Approve multiple cases in a single request.
        Maximum 50 cases per request.
      operationId: bulkApprove
      tags:
        - Cases
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkApproveRequest'
      responses:
        '200':
          description: Bulk approval completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/bulk-reject:
    post:
      summary: Bulk Reject Cases
      description: |
        Reject multiple cases in a single request.
        Maximum 50 cases per request.
      operationId: bulkReject
      tags:
        - Cases
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkRejectRequest'
      responses:
        '200':
          description: Bulk rejection completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/cases/{caseId}/notes:
    get:
      summary: List Case Notes
      description: Get all notes for a case.
      operationId: listCaseNotes
      tags:
        - Notes
      security:
        - bearerAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Notes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListNotesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Add Case Note
      description: Add a note to a case.
      operationId: addCaseNote
      tags:
        - Notes
      security:
        - bearerAuth: []
      parameters:
        - name: caseId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddNoteRequest'
      responses:
        '201':
          description: Note added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Note'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/verifications/{verificationId}/documents:
    post:
      summary: Upload Document
      description: |
        Upload a document image to a verification case.

        The image must be provided as a base64-encoded data URI.
        Supported formats: JPEG, PNG, PDF.
        Maximum file size: 10MB.
        Minimum image dimensions: 640x480 pixels.
      operationId: uploadDocument
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: verificationId
          in: path
          required: true
          description: The verification case ID
          schema:
            type: string
            example: ver_abc123def456
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadDocumentRequest'
            examples:
              omangFront:
                summary: Upload Omang front
                value:
                  documentType: omang_front
                  imageData: "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
                  metadata:
                    captureMethod: camera
                    deviceType: mobile
                    timestamp: "2026-01-14T10:00:00Z"
              selfie:
                summary: Upload selfie
                value:
                  documentType: selfie
                  imageData: "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
                  metadata:
                    captureMethod: camera
                    deviceType: mobile
      responses:
        '201':
          description: Document uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadDocumentResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidType:
                  summary: Invalid document type
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid request parameters
                      details:
                        - field: documentType
                          message: "Invalid enum value"
                    meta:
                      requestId: req_abc123
                      timestamp: "2026-01-14T10:00:00Z"
                invalidBase64:
                  summary: Invalid base64 data
                  value:
                    error:
                      code: INVALID_FILE_TYPE
                      message: Invalid image data format
                      details:
                        - field: imageData
                          message: "Must be a valid base64 data URI"
                    meta:
                      requestId: req_abc123
                      timestamp: "2026-01-14T10:00:00Z"
                imageTooSmall:
                  summary: Image dimensions too small
                  value:
                    error:
                      code: IMAGE_TOO_SMALL
                      message: Image dimensions do not meet minimum requirements
                      details:
                        - field: imageData
                          message: "Image dimensions: 320x240, Minimum: 640x480"
                    meta:
                      requestId: req_abc123
                      timestamp: "2026-01-14T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - client does not own verification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Verification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: FILE_TOO_LARGE
                  message: File size exceeds maximum allowed size of 10MB
                  details:
                    - field: imageData
                      message: "File size: 12.50MB, Maximum: 10MB"
                meta:
                  requestId: req_abc123
                  timestamp: "2026-01-14T10:00:00Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/verifications/{verificationId}/documents/{documentId}/url:
    post:
      summary: Refresh Document URL
      description: |
        Generate a new presigned URL for accessing a document.
        Presigned URLs expire after 15 minutes.
      operationId: refreshDocumentUrl
      tags:
        - Documents
      security:
        - bearerAuth: []
      parameters:
        - name: verificationId
          in: path
          required: true
          description: The verification case ID
          schema:
            type: string
            example: ver_abc123def456
        - name: documentId
          in: path
          required: true
          description: The document ID
          schema:
            type: string
            example: doc_xyz789
      responses:
        '200':
          description: New presigned URL generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshUrlResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Document or verification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    apiKeyAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key
      description: |
        API key authentication for server-to-server integration.

        Format: `ab_live_` or `ab_test_` followed by 32 hex characters.

        Example: `ab_live_1234567890abcdef1234567890abcdef`

        Obtain API keys from the Backoffice dashboard or via API key management endpoints.

    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from authentication endpoint

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    CreateVerificationRequest:
      type: object
      required:
        - documentType
      properties:
        documentType:
          type: string
          enum: [omang, passport, drivers_license]
        callbackUrl:
          type: string
          format: uri
        idempotencyKey:
          type: string
          maxLength: 64
        metadata:
          type: object
          additionalProperties: true

    CreateVerificationResponse:
      type: object
      properties:
        verificationId:
          type: string
        status:
          type: string
          enum: [pending, processing, completed, expired]
        sessionToken:
          type: string
        sdkUrl:
          type: string
          format: uri
        expiresAt:
          type: string
          format: date-time
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ListCasesResponse:
      type: object
      properties:
        cases:
          type: array
          items:
            $ref: '#/components/schemas/CaseSummary'
        pagination:
          $ref: '#/components/schemas/Pagination'
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    CaseSummary:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
          enum: [pending, approved, rejected, expired]
        documentType:
          type: string
        customerName:
          type: string
        createdAt:
          type: string
          format: date-time
        requiresManualReview:
          type: boolean

    CaseDetails:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        documentType:
          type: string
        customer:
          $ref: '#/components/schemas/CustomerData'
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentSummary'
        ocrResults:
          type: object
        biometricResults:
          type: object
        duplicateCheck:
          type: object
        timeline:
          type: array
          items:
            $ref: '#/components/schemas/TimelineEvent'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    CustomerData:
      type: object
      properties:
        idNumber:
          type: string
        surname:
          type: string
        forenames:
          type: string
        dateOfBirth:
          type: string
          format: date
        nationality:
          type: string
        sex:
          type: string

    DocumentSummary:
      type: object
      properties:
        documentId:
          type: string
        documentType:
          type: string
        status:
          type: string
        presignedUrl:
          type: string
          format: uri
        uploadedAt:
          type: string
          format: date-time

    ApproveRequest:
      type: object
      properties:
        note:
          type: string
          maxLength: 1000

    RejectRequest:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
          enum:
            - DOCUMENT_UNREADABLE
            - DOCUMENT_EXPIRED
            - FACE_MISMATCH
            - SUSPECTED_FRAUD
            - DUPLICATE_APPLICATION
            - OTHER
        note:
          type: string
          maxLength: 1000

    CaseActionResponse:
      type: object
      properties:
        caseId:
          type: string
        status:
          type: string
        processedAt:
          type: string
          format: date-time
        processedBy:
          type: string
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    BulkApproveRequest:
      type: object
      required:
        - caseIds
      properties:
        caseIds:
          type: array
          items:
            type: string
          minItems: 1
          maxItems: 50
        note:
          type: string

    BulkRejectRequest:
      type: object
      required:
        - caseIds
        - reason
      properties:
        caseIds:
          type: array
          items:
            type: string
          minItems: 1
          maxItems: 50
        reason:
          type: string
          enum:
            - DOCUMENT_UNREADABLE
            - DOCUMENT_EXPIRED
            - FACE_MISMATCH
            - SUSPECTED_FRAUD
            - DUPLICATE_APPLICATION
            - OTHER
        note:
          type: string

    BulkActionResponse:
      type: object
      properties:
        processed:
          type: integer
        succeeded:
          type: integer
        failed:
          type: integer
        results:
          type: array
          items:
            type: object
            properties:
              caseId:
                type: string
              success:
                type: boolean
              error:
                type: string
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ListNotesResponse:
      type: object
      properties:
        notes:
          type: array
          items:
            $ref: '#/components/schemas/Note'
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    Note:
      type: object
      properties:
        noteId:
          type: string
        caseId:
          type: string
        content:
          type: string
        createdBy:
          type: string
        createdAt:
          type: string
          format: date-time

    AddNoteRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 1
          maxLength: 2000

    TimelineEvent:
      type: object
      properties:
        event:
          type: string
        timestamp:
          type: string
          format: date-time
        actor:
          type: string
        details:
          type: object

    Pagination:
      type: object
      properties:
        cursor:
          type: string
        hasMore:
          type: boolean
        total:
          type: integer
    UploadDocumentRequest:
      type: object
      required:
        - documentType
        - imageData
      properties:
        documentType:
          type: string
          enum:
            - omang_front
            - omang_back
            - selfie
            - passport
            - drivers_license_front
            - drivers_license_back
            - id_card_front
            - id_card_back
          description: Type of document being uploaded
        imageData:
          type: string
          description: Base64-encoded data URI (e.g., data:image/jpeg;base64,...)
          example: "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
        metadata:
          type: object
          properties:
            captureMethod:
              type: string
              enum: [camera, upload]
              description: How the image was captured
            deviceType:
              type: string
              enum: [mobile, desktop, tablet]
              description: Device type used for capture
            timestamp:
              type: string
              format: date-time
              description: When the image was captured

    UploadDocumentResponse:
      type: object
      properties:
        documentId:
          type: string
          description: Unique document identifier
          example: doc_abc123def456
        verificationId:
          type: string
          description: Associated verification case ID
          example: ver_abc123def456
        documentType:
          type: string
          description: Type of document
          example: omang_front
        s3Key:
          type: string
          description: S3 object key
          example: client_abc123/ver_def456/omang_front-1673616000000.jpg
        fileSize:
          type: integer
          description: File size in bytes
          example: 1048576
        mimeType:
          type: string
          description: MIME type of the file
          example: image/jpeg
        uploadedAt:
          type: string
          format: date-time
          description: Upload timestamp
          example: "2026-01-14T10:00:00Z"
        status:
          type: string
          enum: [uploaded, processing, processed, failed]
          description: Document processing status
          example: uploaded
        presignedUrl:
          type: string
          format: uri
          description: Presigned URL for document access (expires in 15 minutes)
          example: "https://authbridge-documents-prod.s3.af-south-1.amazonaws.com/..."
        presignedUrlExpiresAt:
          type: string
          format: date-time
          description: When the presigned URL expires
          example: "2026-01-14T10:15:00Z"
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    RefreshUrlResponse:
      type: object
      properties:
        documentId:
          type: string
          example: doc_abc123def456
        verificationId:
          type: string
          example: ver_abc123def456
        presignedUrl:
          type: string
          format: uri
          example: "https://authbridge-documents-prod.s3.af-south-1.amazonaws.com/..."
        presignedUrlExpiresAt:
          type: string
          format: date-time
          example: "2026-01-14T10:15:00Z"
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
              example: VALIDATION_ERROR
            message:
              type: string
              description: Human-readable error message
              example: Invalid request parameters
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    description: Field that caused the error
                  message:
                    type: string
                    description: Detailed error message
        meta:
          $ref: '#/components/schemas/ResponseMeta'

    ResponseMeta:
      type: object
      properties:
        requestId:
          type: string
          description: Unique request identifier for debugging
          example: req_abc123
        timestamp:
          type: string
          format: date-time
          description: Response timestamp
          example: "2026-01-14T10:00:00Z"

tags:
  - name: Verifications
    description: Verification case creation and management
  - name: Documents
    description: Document upload and management endpoints
  - name: Cases
    description: Case review and decision endpoints
  - name: Notes
    description: Case notes and comments
