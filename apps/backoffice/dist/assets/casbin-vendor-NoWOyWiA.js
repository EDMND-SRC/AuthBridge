const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/refine-core-C76UMzuX.js","assets/mantine-core-11geOya2.js","assets/react-vendor-Bce9NwRC.js","assets/query-vendor-Bv2RRxJ6.js"])))=>i.map(i=>d[i]);
import{g as kt}from"./react-vendor-Bce9NwRC.js";var nt={},De={},mt;function zt(){if(mt)return De;mt=1,De.byteLength=a,De.toByteArray=p,De.fromByteArray=w;for(var l=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=r.length;n<o;++n)l[n]=r[n],e[r.charCodeAt(n)]=n;e[45]=62,e[95]=63;function c(x){var N=x.length;if(N%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=x.indexOf("=");I===-1&&(I=N);var F=I===N?0:4-I%4;return[I,F]}function a(x){var N=c(x),I=N[0],F=N[1];return(I+F)*3/4-F}function h(x,N,I){return(N+I)*3/4-I}function p(x){var N,I=c(x),F=I[0],R=I[1],B=new t(h(x,F,R)),v=0,O=R>0?F-4:F,A;for(A=0;A<O;A+=4)N=e[x.charCodeAt(A)]<<18|e[x.charCodeAt(A+1)]<<12|e[x.charCodeAt(A+2)]<<6|e[x.charCodeAt(A+3)],B[v++]=N>>16&255,B[v++]=N>>8&255,B[v++]=N&255;return R===2&&(N=e[x.charCodeAt(A)]<<2|e[x.charCodeAt(A+1)]>>4,B[v++]=N&255),R===1&&(N=e[x.charCodeAt(A)]<<10|e[x.charCodeAt(A+1)]<<4|e[x.charCodeAt(A+2)]>>2,B[v++]=N>>8&255,B[v++]=N&255),B}function g(x){return l[x>>18&63]+l[x>>12&63]+l[x>>6&63]+l[x&63]}function E(x,N,I){for(var F,R=[],B=N;B<I;B+=3)F=(x[B]<<16&16711680)+(x[B+1]<<8&65280)+(x[B+2]&255),R.push(g(F));return R.join("")}function w(x){for(var N,I=x.length,F=I%3,R=[],B=16383,v=0,O=I-F;v<O;v+=B)R.push(E(x,v,v+B>O?O:v+B));return F===1?(N=x[I-1],R.push(l[N>>2]+l[N<<4&63]+"==")):F===2&&(N=(x[I-2]<<8)+x[I-1],R.push(l[N>>10]+l[N>>4&63]+l[N<<2&63]+"=")),R.join("")}return De}var Ge={};var gt;function Ht(){return gt||(gt=1,Ge.read=function(l,e,t,r,n){var o,c,a=n*8-r-1,h=(1<<a)-1,p=h>>1,g=-7,E=t?n-1:0,w=t?-1:1,x=l[e+E];for(E+=w,o=x&(1<<-g)-1,x>>=-g,g+=a;g>0;o=o*256+l[e+E],E+=w,g-=8);for(c=o&(1<<-g)-1,o>>=-g,g+=r;g>0;c=c*256+l[e+E],E+=w,g-=8);if(o===0)o=1-p;else{if(o===h)return c?NaN:(x?-1:1)*(1/0);c=c+Math.pow(2,r),o=o-p}return(x?-1:1)*c*Math.pow(2,o-r)},Ge.write=function(l,e,t,r,n,o){var c,a,h,p=o*8-n-1,g=(1<<p)-1,E=g>>1,w=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=r?0:o-1,N=r?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,c=g):(c=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-c))<1&&(c--,h*=2),c+E>=1?e+=w/h:e+=w*Math.pow(2,1-E),e*h>=2&&(c++,h/=2),c+E>=g?(a=0,c=g):c+E>=1?(a=(e*h-1)*Math.pow(2,n),c=c+E):(a=e*Math.pow(2,E-1)*Math.pow(2,n),c=0));n>=8;l[t+x]=a&255,x+=N,a/=256,n-=8);for(c=c<<n|a,p+=n;p>0;l[t+x]=c&255,x+=N,c/=256,p-=8);l[t+x-N]|=I*128}),Ge}var yt;function Qt(){return yt||(yt=1,(function(l){const e=zt(),t=Ht(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;l.Buffer=a,l.SlowBuffer=B,l.INSPECT_MAX_BYTES=50;const n=2147483647;l.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const u=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(u,i),u.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function c(u){if(u>n)throw new RangeError('The value "'+u+'" is invalid for option "size"');const i=new Uint8Array(u);return Object.setPrototypeOf(i,a.prototype),i}function a(u,i,s){if(typeof u=="number"){if(typeof i=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(u)}return h(u,i,s)}a.poolSize=8192;function h(u,i,s){if(typeof u=="string")return w(u,i);if(ArrayBuffer.isView(u))return N(u);if(u==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof u);if(de(u,ArrayBuffer)||u&&de(u.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(de(u,SharedArrayBuffer)||u&&de(u.buffer,SharedArrayBuffer)))return I(u,i,s);if(typeof u=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const f=u.valueOf&&u.valueOf();if(f!=null&&f!==u)return a.from(f,i,s);const d=F(u);if(d)return d;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof u[Symbol.toPrimitive]=="function")return a.from(u[Symbol.toPrimitive]("string"),i,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof u)}a.from=function(u,i,s){return h(u,i,s)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function p(u){if(typeof u!="number")throw new TypeError('"size" argument must be of type number');if(u<0)throw new RangeError('The value "'+u+'" is invalid for option "size"')}function g(u,i,s){return p(u),u<=0?c(u):i!==void 0?typeof s=="string"?c(u).fill(i,s):c(u).fill(i):c(u)}a.alloc=function(u,i,s){return g(u,i,s)};function E(u){return p(u),c(u<0?0:R(u)|0)}a.allocUnsafe=function(u){return E(u)},a.allocUnsafeSlow=function(u){return E(u)};function w(u,i){if((typeof i!="string"||i==="")&&(i="utf8"),!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i);const s=v(u,i)|0;let f=c(s);const d=f.write(u,i);return d!==s&&(f=f.slice(0,d)),f}function x(u){const i=u.length<0?0:R(u.length)|0,s=c(i);for(let f=0;f<i;f+=1)s[f]=u[f]&255;return s}function N(u){if(de(u,Uint8Array)){const i=new Uint8Array(u);return I(i.buffer,i.byteOffset,i.byteLength)}return x(u)}function I(u,i,s){if(i<0||u.byteLength<i)throw new RangeError('"offset" is outside of buffer bounds');if(u.byteLength<i+(s||0))throw new RangeError('"length" is outside of buffer bounds');let f;return i===void 0&&s===void 0?f=new Uint8Array(u):s===void 0?f=new Uint8Array(u,i):f=new Uint8Array(u,i,s),Object.setPrototypeOf(f,a.prototype),f}function F(u){if(a.isBuffer(u)){const i=R(u.length)|0,s=c(i);return s.length===0||u.copy(s,0,0,i),s}if(u.length!==void 0)return typeof u.length!="number"||Ie(u.length)?c(0):x(u);if(u.type==="Buffer"&&Array.isArray(u.data))return x(u.data)}function R(u){if(u>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return u|0}function B(u){return+u!=u&&(u=0),a.alloc(+u)}a.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==a.prototype},a.compare=function(i,s){if(de(i,Uint8Array)&&(i=a.from(i,i.offset,i.byteLength)),de(s,Uint8Array)&&(s=a.from(s,s.offset,s.byteLength)),!a.isBuffer(i)||!a.isBuffer(s))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===s)return 0;let f=i.length,d=s.length;for(let m=0,y=Math.min(f,d);m<y;++m)if(i[m]!==s[m]){f=i[m],d=s[m];break}return f<d?-1:d<f?1:0},a.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(i,s){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return a.alloc(0);let f;if(s===void 0)for(s=0,f=0;f<i.length;++f)s+=i[f].length;const d=a.allocUnsafe(s);let m=0;for(f=0;f<i.length;++f){let y=i[f];if(de(y,Uint8Array))m+y.length>d.length?(a.isBuffer(y)||(y=a.from(y)),y.copy(d,m)):Uint8Array.prototype.set.call(d,y,m);else if(a.isBuffer(y))y.copy(d,m);else throw new TypeError('"list" argument must be an Array of Buffers');m+=y.length}return d};function v(u,i){if(a.isBuffer(u))return u.length;if(ArrayBuffer.isView(u)||de(u,ArrayBuffer))return u.byteLength;if(typeof u!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof u);const s=u.length,f=arguments.length>2&&arguments[2]===!0;if(!f&&s===0)return 0;let d=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return Ce(u).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s*2;case"hex":return s>>>1;case"base64":return We(u).length;default:if(d)return f?-1:Ce(u).length;i=(""+i).toLowerCase(),d=!0}}a.byteLength=v;function O(u,i,s){let f=!1;if((i===void 0||i<0)&&(i=0),i>this.length||((s===void 0||s>this.length)&&(s=this.length),s<=0)||(s>>>=0,i>>>=0,s<=i))return"";for(u||(u="utf8");;)switch(u){case"hex":return se(this,i,s);case"utf8":case"utf-8":return L(this,i,s);case"ascii":return q(this,i,s);case"latin1":case"binary":return re(this,i,s);case"base64":return P(this,i,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ie(this,i,s);default:if(f)throw new TypeError("Unknown encoding: "+u);u=(u+"").toLowerCase(),f=!0}}a.prototype._isBuffer=!0;function A(u,i,s){const f=u[i];u[i]=u[s],u[s]=f}a.prototype.swap16=function(){const i=this.length;if(i%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let s=0;s<i;s+=2)A(this,s,s+1);return this},a.prototype.swap32=function(){const i=this.length;if(i%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let s=0;s<i;s+=4)A(this,s,s+3),A(this,s+1,s+2);return this},a.prototype.swap64=function(){const i=this.length;if(i%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let s=0;s<i;s+=8)A(this,s,s+7),A(this,s+1,s+6),A(this,s+2,s+5),A(this,s+3,s+4);return this},a.prototype.toString=function(){const i=this.length;return i===0?"":arguments.length===0?L(this,0,i):O.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(i){if(!a.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i?!0:a.compare(this,i)===0},a.prototype.inspect=function(){let i="";const s=l.INSPECT_MAX_BYTES;return i=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(i+=" ... "),"<Buffer "+i+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(i,s,f,d,m){if(de(i,Uint8Array)&&(i=a.from(i,i.offset,i.byteLength)),!a.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(s===void 0&&(s=0),f===void 0&&(f=i?i.length:0),d===void 0&&(d=0),m===void 0&&(m=this.length),s<0||f>i.length||d<0||m>this.length)throw new RangeError("out of range index");if(d>=m&&s>=f)return 0;if(d>=m)return-1;if(s>=f)return 1;if(s>>>=0,f>>>=0,d>>>=0,m>>>=0,this===i)return 0;let y=m-d,U=f-s;const K=Math.min(y,U),Y=this.slice(d,m),Z=i.slice(s,f);for(let Q=0;Q<K;++Q)if(Y[Q]!==Z[Q]){y=Y[Q],U=Z[Q];break}return y<U?-1:U<y?1:0};function D(u,i,s,f,d){if(u.length===0)return-1;if(typeof s=="string"?(f=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,Ie(s)&&(s=d?0:u.length-1),s<0&&(s=u.length+s),s>=u.length){if(d)return-1;s=u.length-1}else if(s<0)if(d)s=0;else return-1;if(typeof i=="string"&&(i=a.from(i,f)),a.isBuffer(i))return i.length===0?-1:$(u,i,s,f,d);if(typeof i=="number")return i=i&255,typeof Uint8Array.prototype.indexOf=="function"?d?Uint8Array.prototype.indexOf.call(u,i,s):Uint8Array.prototype.lastIndexOf.call(u,i,s):$(u,[i],s,f,d);throw new TypeError("val must be string, number or Buffer")}function $(u,i,s,f,d){let m=1,y=u.length,U=i.length;if(f!==void 0&&(f=String(f).toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(u.length<2||i.length<2)return-1;m=2,y/=2,U/=2,s/=2}function K(Z,Q){return m===1?Z[Q]:Z.readUInt16BE(Q*m)}let Y;if(d){let Z=-1;for(Y=s;Y<y;Y++)if(K(u,Y)===K(i,Z===-1?0:Y-Z)){if(Z===-1&&(Z=Y),Y-Z+1===U)return Z*m}else Z!==-1&&(Y-=Y-Z),Z=-1}else for(s+U>y&&(s=y-U),Y=s;Y>=0;Y--){let Z=!0;for(let Q=0;Q<U;Q++)if(K(u,Y+Q)!==K(i,Q)){Z=!1;break}if(Z)return Y}return-1}a.prototype.includes=function(i,s,f){return this.indexOf(i,s,f)!==-1},a.prototype.indexOf=function(i,s,f){return D(this,i,s,f,!0)},a.prototype.lastIndexOf=function(i,s,f){return D(this,i,s,f,!1)};function H(u,i,s,f){s=Number(s)||0;const d=u.length-s;f?(f=Number(f),f>d&&(f=d)):f=d;const m=i.length;f>m/2&&(f=m/2);let y;for(y=0;y<f;++y){const U=parseInt(i.substr(y*2,2),16);if(Ie(U))return y;u[s+y]=U}return y}function T(u,i,s,f){return Ne(Ce(i,u.length-s),u,s,f)}function W(u,i,s,f){return Ne(je(i),u,s,f)}function M(u,i,s,f){return Ne(We(i),u,s,f)}function C(u,i,s,f){return Ne(qe(i,u.length-s),u,s,f)}a.prototype.write=function(i,s,f,d){if(s===void 0)d="utf8",f=this.length,s=0;else if(f===void 0&&typeof s=="string")d=s,f=this.length,s=0;else if(isFinite(s))s=s>>>0,isFinite(f)?(f=f>>>0,d===void 0&&(d="utf8")):(d=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const m=this.length-s;if((f===void 0||f>m)&&(f=m),i.length>0&&(f<0||s<0)||s>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");let y=!1;for(;;)switch(d){case"hex":return H(this,i,s,f);case"utf8":case"utf-8":return T(this,i,s,f);case"ascii":case"latin1":case"binary":return W(this,i,s,f);case"base64":return M(this,i,s,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,i,s,f);default:if(y)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),y=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(u,i,s){return i===0&&s===u.length?e.fromByteArray(u):e.fromByteArray(u.slice(i,s))}function L(u,i,s){s=Math.min(u.length,s);const f=[];let d=i;for(;d<s;){const m=u[d];let y=null,U=m>239?4:m>223?3:m>191?2:1;if(d+U<=s){let K,Y,Z,Q;switch(U){case 1:m<128&&(y=m);break;case 2:K=u[d+1],(K&192)===128&&(Q=(m&31)<<6|K&63,Q>127&&(y=Q));break;case 3:K=u[d+1],Y=u[d+2],(K&192)===128&&(Y&192)===128&&(Q=(m&15)<<12|(K&63)<<6|Y&63,Q>2047&&(Q<55296||Q>57343)&&(y=Q));break;case 4:K=u[d+1],Y=u[d+2],Z=u[d+3],(K&192)===128&&(Y&192)===128&&(Z&192)===128&&(Q=(m&15)<<18|(K&63)<<12|(Y&63)<<6|Z&63,Q>65535&&Q<1114112&&(y=Q))}}y===null?(y=65533,U=1):y>65535&&(y-=65536,f.push(y>>>10&1023|55296),y=56320|y&1023),f.push(y),d+=U}return ee(f)}const J=4096;function ee(u){const i=u.length;if(i<=J)return String.fromCharCode.apply(String,u);let s="",f=0;for(;f<i;)s+=String.fromCharCode.apply(String,u.slice(f,f+=J));return s}function q(u,i,s){let f="";s=Math.min(u.length,s);for(let d=i;d<s;++d)f+=String.fromCharCode(u[d]&127);return f}function re(u,i,s){let f="";s=Math.min(u.length,s);for(let d=i;d<s;++d)f+=String.fromCharCode(u[d]);return f}function se(u,i,s){const f=u.length;(!i||i<0)&&(i=0),(!s||s<0||s>f)&&(s=f);let d="";for(let m=i;m<s;++m)d+=ke[u[m]];return d}function ie(u,i,s){const f=u.slice(i,s);let d="";for(let m=0;m<f.length-1;m+=2)d+=String.fromCharCode(f[m]+f[m+1]*256);return d}a.prototype.slice=function(i,s){const f=this.length;i=~~i,s=s===void 0?f:~~s,i<0?(i+=f,i<0&&(i=0)):i>f&&(i=f),s<0?(s+=f,s<0&&(s=0)):s>f&&(s=f),s<i&&(s=i);const d=this.subarray(i,s);return Object.setPrototypeOf(d,a.prototype),d};function j(u,i,s){if(u%1!==0||u<0)throw new RangeError("offset is not uint");if(u+i>s)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(i,s,f){i=i>>>0,s=s>>>0,f||j(i,s,this.length);let d=this[i],m=1,y=0;for(;++y<s&&(m*=256);)d+=this[i+y]*m;return d},a.prototype.readUintBE=a.prototype.readUIntBE=function(i,s,f){i=i>>>0,s=s>>>0,f||j(i,s,this.length);let d=this[i+--s],m=1;for(;s>0&&(m*=256);)d+=this[i+--s]*m;return d},a.prototype.readUint8=a.prototype.readUInt8=function(i,s){return i=i>>>0,s||j(i,1,this.length),this[i]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(i,s){return i=i>>>0,s||j(i,2,this.length),this[i]|this[i+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(i,s){return i=i>>>0,s||j(i,2,this.length),this[i]<<8|this[i+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(i,s){return i=i>>>0,s||j(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+this[i+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(i,s){return i=i>>>0,s||j(i,4,this.length),this[i]*16777216+(this[i+1]<<16|this[i+2]<<8|this[i+3])},a.prototype.readBigUInt64LE=me(function(i){i=i>>>0,Ee(i,"offset");const s=this[i],f=this[i+7];(s===void 0||f===void 0)&&Se(i,this.length-8);const d=s+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24,m=this[++i]+this[++i]*2**8+this[++i]*2**16+f*2**24;return BigInt(d)+(BigInt(m)<<BigInt(32))}),a.prototype.readBigUInt64BE=me(function(i){i=i>>>0,Ee(i,"offset");const s=this[i],f=this[i+7];(s===void 0||f===void 0)&&Se(i,this.length-8);const d=s*2**24+this[++i]*2**16+this[++i]*2**8+this[++i],m=this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+f;return(BigInt(d)<<BigInt(32))+BigInt(m)}),a.prototype.readIntLE=function(i,s,f){i=i>>>0,s=s>>>0,f||j(i,s,this.length);let d=this[i],m=1,y=0;for(;++y<s&&(m*=256);)d+=this[i+y]*m;return m*=128,d>=m&&(d-=Math.pow(2,8*s)),d},a.prototype.readIntBE=function(i,s,f){i=i>>>0,s=s>>>0,f||j(i,s,this.length);let d=s,m=1,y=this[i+--d];for(;d>0&&(m*=256);)y+=this[i+--d]*m;return m*=128,y>=m&&(y-=Math.pow(2,8*s)),y},a.prototype.readInt8=function(i,s){return i=i>>>0,s||j(i,1,this.length),this[i]&128?(255-this[i]+1)*-1:this[i]},a.prototype.readInt16LE=function(i,s){i=i>>>0,s||j(i,2,this.length);const f=this[i]|this[i+1]<<8;return f&32768?f|4294901760:f},a.prototype.readInt16BE=function(i,s){i=i>>>0,s||j(i,2,this.length);const f=this[i+1]|this[i]<<8;return f&32768?f|4294901760:f},a.prototype.readInt32LE=function(i,s){return i=i>>>0,s||j(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},a.prototype.readInt32BE=function(i,s){return i=i>>>0,s||j(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},a.prototype.readBigInt64LE=me(function(i){i=i>>>0,Ee(i,"offset");const s=this[i],f=this[i+7];(s===void 0||f===void 0)&&Se(i,this.length-8);const d=this[i+4]+this[i+5]*2**8+this[i+6]*2**16+(f<<24);return(BigInt(d)<<BigInt(32))+BigInt(s+this[++i]*2**8+this[++i]*2**16+this[++i]*2**24)}),a.prototype.readBigInt64BE=me(function(i){i=i>>>0,Ee(i,"offset");const s=this[i],f=this[i+7];(s===void 0||f===void 0)&&Se(i,this.length-8);const d=(s<<24)+this[++i]*2**16+this[++i]*2**8+this[++i];return(BigInt(d)<<BigInt(32))+BigInt(this[++i]*2**24+this[++i]*2**16+this[++i]*2**8+f)}),a.prototype.readFloatLE=function(i,s){return i=i>>>0,s||j(i,4,this.length),t.read(this,i,!0,23,4)},a.prototype.readFloatBE=function(i,s){return i=i>>>0,s||j(i,4,this.length),t.read(this,i,!1,23,4)},a.prototype.readDoubleLE=function(i,s){return i=i>>>0,s||j(i,8,this.length),t.read(this,i,!0,52,8)},a.prototype.readDoubleBE=function(i,s){return i=i>>>0,s||j(i,8,this.length),t.read(this,i,!1,52,8)};function k(u,i,s,f,d,m){if(!a.isBuffer(u))throw new TypeError('"buffer" argument must be a Buffer instance');if(i>d||i<m)throw new RangeError('"value" argument is out of bounds');if(s+f>u.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(i,s,f,d){if(i=+i,s=s>>>0,f=f>>>0,!d){const U=Math.pow(2,8*f)-1;k(this,i,s,f,U,0)}let m=1,y=0;for(this[s]=i&255;++y<f&&(m*=256);)this[s+y]=i/m&255;return s+f},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(i,s,f,d){if(i=+i,s=s>>>0,f=f>>>0,!d){const U=Math.pow(2,8*f)-1;k(this,i,s,f,U,0)}let m=f-1,y=1;for(this[s+m]=i&255;--m>=0&&(y*=256);)this[s+m]=i/y&255;return s+f},a.prototype.writeUint8=a.prototype.writeUInt8=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,1,255,0),this[s]=i&255,s+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,2,65535,0),this[s]=i&255,this[s+1]=i>>>8,s+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,2,65535,0),this[s]=i>>>8,this[s+1]=i&255,s+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,4,4294967295,0),this[s+3]=i>>>24,this[s+2]=i>>>16,this[s+1]=i>>>8,this[s]=i&255,s+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,4,4294967295,0),this[s]=i>>>24,this[s+1]=i>>>16,this[s+2]=i>>>8,this[s+3]=i&255,s+4};function G(u,i,s,f,d){_e(i,f,d,u,s,7);let m=Number(i&BigInt(4294967295));u[s++]=m,m=m>>8,u[s++]=m,m=m>>8,u[s++]=m,m=m>>8,u[s++]=m;let y=Number(i>>BigInt(32)&BigInt(4294967295));return u[s++]=y,y=y>>8,u[s++]=y,y=y>>8,u[s++]=y,y=y>>8,u[s++]=y,s}function S(u,i,s,f,d){_e(i,f,d,u,s,7);let m=Number(i&BigInt(4294967295));u[s+7]=m,m=m>>8,u[s+6]=m,m=m>>8,u[s+5]=m,m=m>>8,u[s+4]=m;let y=Number(i>>BigInt(32)&BigInt(4294967295));return u[s+3]=y,y=y>>8,u[s+2]=y,y=y>>8,u[s+1]=y,y=y>>8,u[s]=y,s+8}a.prototype.writeBigUInt64LE=me(function(i,s=0){return G(this,i,s,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=me(function(i,s=0){return S(this,i,s,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(i,s,f,d){if(i=+i,s=s>>>0,!d){const K=Math.pow(2,8*f-1);k(this,i,s,f,K-1,-K)}let m=0,y=1,U=0;for(this[s]=i&255;++m<f&&(y*=256);)i<0&&U===0&&this[s+m-1]!==0&&(U=1),this[s+m]=(i/y>>0)-U&255;return s+f},a.prototype.writeIntBE=function(i,s,f,d){if(i=+i,s=s>>>0,!d){const K=Math.pow(2,8*f-1);k(this,i,s,f,K-1,-K)}let m=f-1,y=1,U=0;for(this[s+m]=i&255;--m>=0&&(y*=256);)i<0&&U===0&&this[s+m+1]!==0&&(U=1),this[s+m]=(i/y>>0)-U&255;return s+f},a.prototype.writeInt8=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,1,127,-128),i<0&&(i=255+i+1),this[s]=i&255,s+1},a.prototype.writeInt16LE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,2,32767,-32768),this[s]=i&255,this[s+1]=i>>>8,s+2},a.prototype.writeInt16BE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,2,32767,-32768),this[s]=i>>>8,this[s+1]=i&255,s+2},a.prototype.writeInt32LE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,4,2147483647,-2147483648),this[s]=i&255,this[s+1]=i>>>8,this[s+2]=i>>>16,this[s+3]=i>>>24,s+4},a.prototype.writeInt32BE=function(i,s,f){return i=+i,s=s>>>0,f||k(this,i,s,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[s]=i>>>24,this[s+1]=i>>>16,this[s+2]=i>>>8,this[s+3]=i&255,s+4},a.prototype.writeBigInt64LE=me(function(i,s=0){return G(this,i,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=me(function(i,s=0){return S(this,i,s,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function _(u,i,s,f,d,m){if(s+f>u.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function ae(u,i,s,f,d){return i=+i,s=s>>>0,d||_(u,i,s,4),t.write(u,i,s,f,23,4),s+4}a.prototype.writeFloatLE=function(i,s,f){return ae(this,i,s,!0,f)},a.prototype.writeFloatBE=function(i,s,f){return ae(this,i,s,!1,f)};function we(u,i,s,f,d){return i=+i,s=s>>>0,d||_(u,i,s,8),t.write(u,i,s,f,52,8),s+8}a.prototype.writeDoubleLE=function(i,s,f){return we(this,i,s,!0,f)},a.prototype.writeDoubleBE=function(i,s,f){return we(this,i,s,!1,f)},a.prototype.copy=function(i,s,f,d){if(!a.isBuffer(i))throw new TypeError("argument should be a Buffer");if(f||(f=0),!d&&d!==0&&(d=this.length),s>=i.length&&(s=i.length),s||(s=0),d>0&&d<f&&(d=f),d===f||i.length===0||this.length===0)return 0;if(s<0)throw new RangeError("targetStart out of bounds");if(f<0||f>=this.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),i.length-s<d-f&&(d=i.length-s+f);const m=d-f;return this===i&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(s,f,d):Uint8Array.prototype.set.call(i,this.subarray(f,d),s),m},a.prototype.fill=function(i,s,f,d){if(typeof i=="string"){if(typeof s=="string"?(d=s,s=0,f=this.length):typeof f=="string"&&(d=f,f=this.length),d!==void 0&&typeof d!="string")throw new TypeError("encoding must be a string");if(typeof d=="string"&&!a.isEncoding(d))throw new TypeError("Unknown encoding: "+d);if(i.length===1){const y=i.charCodeAt(0);(d==="utf8"&&y<128||d==="latin1")&&(i=y)}}else typeof i=="number"?i=i&255:typeof i=="boolean"&&(i=Number(i));if(s<0||this.length<s||this.length<f)throw new RangeError("Out of range index");if(f<=s)return this;s=s>>>0,f=f===void 0?this.length:f>>>0,i||(i=0);let m;if(typeof i=="number")for(m=s;m<f;++m)this[m]=i;else{const y=a.isBuffer(i)?i:a.from(i,d),U=y.length;if(U===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(m=0;m<f-s;++m)this[m+s]=y[m%U]}return this};const X={};function z(u,i,s){X[u]=class extends s{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${u}]`,this.stack,delete this.name}get code(){return u}set code(d){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:d,writable:!0})}toString(){return`${this.name} [${u}]: ${this.message}`}}}z("ERR_BUFFER_OUT_OF_BOUNDS",function(u){return u?`${u} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),z("ERR_INVALID_ARG_TYPE",function(u,i){return`The "${u}" argument must be of type number. Received type ${typeof i}`},TypeError),z("ERR_OUT_OF_RANGE",function(u,i,s){let f=`The value of "${u}" is out of range.`,d=s;return Number.isInteger(s)&&Math.abs(s)>2**32?d=be(String(s)):typeof s=="bigint"&&(d=String(s),(s>BigInt(2)**BigInt(32)||s<-(BigInt(2)**BigInt(32)))&&(d=be(d)),d+="n"),f+=` It must be ${i}. Received ${d}`,f},RangeError);function be(u){let i="",s=u.length;const f=u[0]==="-"?1:0;for(;s>=f+4;s-=3)i=`_${u.slice(s-3,s)}${i}`;return`${u.slice(0,s)}${i}`}function he(u,i,s){Ee(i,"offset"),(u[i]===void 0||u[i+s]===void 0)&&Se(i,u.length-(s+1))}function _e(u,i,s,f,d,m){if(u>s||u<i){const y=typeof i=="bigint"?"n":"";let U;throw i===0||i===BigInt(0)?U=`>= 0${y} and < 2${y} ** ${(m+1)*8}${y}`:U=`>= -(2${y} ** ${(m+1)*8-1}${y}) and < 2 ** ${(m+1)*8-1}${y}`,new X.ERR_OUT_OF_RANGE("value",U,u)}he(f,d,m)}function Ee(u,i){if(typeof u!="number")throw new X.ERR_INVALID_ARG_TYPE(i,"number",u)}function Se(u,i,s){throw Math.floor(u)!==u?(Ee(u,s),new X.ERR_OUT_OF_RANGE("offset","an integer",u)):i<0?new X.ERR_BUFFER_OUT_OF_BOUNDS:new X.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${i}`,u)}const Ae=/[^+/0-9A-Za-z-_]/g;function it(u){if(u=u.split("=")[0],u=u.trim().replace(Ae,""),u.length<2)return"";for(;u.length%4!==0;)u=u+"=";return u}function Ce(u,i){i=i||1/0;let s;const f=u.length;let d=null;const m=[];for(let y=0;y<f;++y){if(s=u.charCodeAt(y),s>55295&&s<57344){if(!d){if(s>56319){(i-=3)>-1&&m.push(239,191,189);continue}else if(y+1===f){(i-=3)>-1&&m.push(239,191,189);continue}d=s;continue}if(s<56320){(i-=3)>-1&&m.push(239,191,189),d=s;continue}s=(d-55296<<10|s-56320)+65536}else d&&(i-=3)>-1&&m.push(239,191,189);if(d=null,s<128){if((i-=1)<0)break;m.push(s)}else if(s<2048){if((i-=2)<0)break;m.push(s>>6|192,s&63|128)}else if(s<65536){if((i-=3)<0)break;m.push(s>>12|224,s>>6&63|128,s&63|128)}else if(s<1114112){if((i-=4)<0)break;m.push(s>>18|240,s>>12&63|128,s>>6&63|128,s&63|128)}else throw new Error("Invalid code point")}return m}function je(u){const i=[];for(let s=0;s<u.length;++s)i.push(u.charCodeAt(s)&255);return i}function qe(u,i){let s,f,d;const m=[];for(let y=0;y<u.length&&!((i-=2)<0);++y)s=u.charCodeAt(y),f=s>>8,d=s%256,m.push(d),m.push(f);return m}function We(u){return e.toByteArray(it(u))}function Ne(u,i,s,f){let d;for(d=0;d<f&&!(d+s>=i.length||d>=u.length);++d)i[d+s]=u[d];return d}function de(u,i){return u instanceof i||u!=null&&u.constructor!=null&&u.constructor.name!=null&&u.constructor.name===i.name}function Ie(u){return u!==u}const ke=(function(){const u="0123456789abcdef",i=new Array(256);for(let s=0;s<16;++s){const f=s*16;for(let d=0;d<16;++d)i[f+d]=u[s]+u[d]}return i})();function me(u){return typeof BigInt>"u"?b:u}function b(){throw new Error("BigInt not supported")}})(nt)),nt}var Ve=Qt();const Yt=/^(\d{1,3}\.){3,3}\d{1,3}$/,Xt=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,ne={toBuffer:function(l,e,t){t=t||0;let r;if(this.isV4Format(l))r=e||new Ve.Buffer(t+4),l.split(/\./g).map(function(n){t=t||0,r[t++]=parseInt(n,10)&255});else if(this.isV6Format(l)){const n=l.split(":",8);let o;for(o=0;o<n.length;o++){const c=this.isV4Format(n[o]);let a;c&&(a=this.toBuffer(n[o]),n[o]=a.slice(0,2).toString("hex")),a&&++o<8&&n.splice(o,0,a.slice(2,4).toString("hex"))}if(n[0]==="")for(;n.length<8;)n.unshift("0");else if(n[n.length-1]==="")for(;n.length<8;)n.push("0");else if(n.length<8){for(o=0;o<n.length&&n[o]!=="";o++);const c=[o,1];for(o=9-n.length;o>0;o--)c.push("0");n.splice.apply(n,c)}for(r=e||new Ve.Buffer(t+16),o=0;o<n.length;o++){const c=parseInt(n[o],16);r[t++]=c>>8&255,r[t++]=c&255}}if(!r)throw Error("Invalid ip address: "+l);return r},toString:function(l,e,t){e=e||0,t=t||l.length-e;let r=[];if(t===4){for(let n=0;n<t;n++)r.push(l[e+n]);r=r.join(".")}else if(t===16){for(let n=0;n<t;n+=2)r.push(l.readUInt16BE(e+n).toString(16));r=r.join(":"),r=r.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),r=r.replace(/:{3,4}/,"::")}return r},isV4Format:function(l){return Yt.test(l)},isV6Format:function(l){return Xt.test(l)},fromPrefixLen:function(l,e){l>32?e="ipv6":e=Kt(typeof e=="string"?e:"");let t=4;e==="ipv6"&&(t=16);const r=new Ve.Buffer(t);for(let n=0,o=r.length;n<o;++n){let c=8;l<8&&(c=l),l-=c,r[n]=~(255>>c)&255}return ne.toString(r)},mask:function(l,e){const t=ne.toBuffer(l),r=ne.toBuffer(e),n=new Ve.Buffer(Math.max(t.length,r.length));let o;if(t.length===r.length)for(o=0;o<t.length;o++)n[o]=t[o]&r[o];else if(r.length===4)for(o=0;o<r.length;o++)n[o]=t[t.length-4+o]&r[o];else{for(let c=0;c<n.length-6;c++)n[c]=0;for(n[10]=255,n[11]=255,o=0;o<t.length;o++)n[o+12]=t[o]&r[o+12];o=o+12}for(;o<n.length;o++)n[o]=0;return ne.toString(n)},subnet:function(l,e){const t=ne.toLong(ne.mask(l,e)),r=ne.toBuffer(e);for(let n=0;n<r.length;n++)r[n]===255||r[n]&255;return{contains:function(n){return t===ne.toLong(ne.mask(n,e))}}},cidrSubnet:function(l){const e=l.split("/"),t=e[0];if(e.length!==2)throw new Error("invalid CIDR subnet: "+t);const r=ne.fromPrefixLen(parseInt(e[1],10));return ne.subnet(t,r)},isEqual:function(l,e){let t=ne.toBuffer(l),r=ne.toBuffer(e);if(t.length===r.length){for(let o=0;o<t.length;o++)if(t[o]!==r[o])return!1;return!0}if(r.length===4){const o=r;r=t,t=o}for(let o=0;o<10;o++)if(r[o]!==0)return!1;const n=r.readUInt16BE(10);if(n!==0&&n!==65535)return!1;for(let o=0;o<4;o++)if(t[o]!==r[o+12])return!1;return!0},toLong:function(l){let e=0;return l.split(".").forEach(function(t){e<<=8,e+=parseInt(t)}),e>>>0},fromLong:function(l){return(l>>>24)+"."+(l>>16&255)+"."+(l>>8&255)+"."+(l&255)}};function Kt(l){return l?l.toLowerCase():"ipv4"}var ot,wt;function Zt(){if(wt)return ot;wt=1,ot=l;function l(r,n,o){r instanceof RegExp&&(r=e(r,o)),n instanceof RegExp&&(n=e(n,o));var c=t(r,n,o);return c&&{start:c[0],end:c[1],pre:o.slice(0,c[0]),body:o.slice(c[0]+r.length,c[1]),post:o.slice(c[1]+n.length)}}function e(r,n){var o=n.match(r);return o?o[0]:null}l.range=t;function t(r,n,o){var c,a,h,p,g,E=o.indexOf(r),w=o.indexOf(n,E+1),x=E;if(E>=0&&w>0){if(r===n)return[E,w];for(c=[],h=o.length;x>=0&&!g;)x==E?(c.push(x),E=o.indexOf(r,x+1)):c.length==1?g=[c.pop(),w]:(a=c.pop(),a<h&&(h=a,p=w),w=o.indexOf(n,x+1)),x=E<w&&E>=0?E:w;c.length&&(g=[h,p])}return g}return ot}var st,_t;function er(){if(_t)return st;_t=1;var l=Zt();st=g;var e="\0SLASH"+Math.random()+"\0",t="\0OPEN"+Math.random()+"\0",r="\0CLOSE"+Math.random()+"\0",n="\0COMMA"+Math.random()+"\0",o="\0PERIOD"+Math.random()+"\0";function c(F){return parseInt(F,10)==F?parseInt(F,10):F.charCodeAt(0)}function a(F){return F.split("\\\\").join(e).split("\\{").join(t).split("\\}").join(r).split("\\,").join(n).split("\\.").join(o)}function h(F){return F.split(e).join("\\").split(t).join("{").split(r).join("}").split(n).join(",").split(o).join(".")}function p(F){if(!F)return[""];var R=[],B=l("{","}",F);if(!B)return F.split(",");var v=B.pre,O=B.body,A=B.post,D=v.split(",");D[D.length-1]+="{"+O+"}";var $=p(A);return A.length&&(D[D.length-1]+=$.shift(),D.push.apply(D,$)),R.push.apply(R,D),R}function g(F){return F?(F.substr(0,2)==="{}"&&(F="\\{\\}"+F.substr(2)),I(a(F),!0).map(h)):[]}function E(F){return"{"+F+"}"}function w(F){return/^-?0\d/.test(F)}function x(F,R){return F<=R}function N(F,R){return F>=R}function I(F,R){var B=[],v=l("{","}",F);if(!v)return[F];var O=v.pre,A=v.post.length?I(v.post,!1):[""];if(/\$$/.test(v.pre))for(var D=0;D<A.length;D++){var $=O+"{"+v.body+"}"+A[D];B.push($)}else{var H=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(v.body),T=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(v.body),W=H||T,M=v.body.indexOf(",")>=0;if(!W&&!M)return v.post.match(/,(?!,).*\}/)?(F=v.pre+"{"+v.body+r+v.post,I(F)):[F];var C;if(W)C=v.body.split(/\.\./);else if(C=p(v.body),C.length===1&&(C=I(C[0],!1).map(E),C.length===1))return A.map(function(ae){return v.pre+C[0]+ae});var P;if(W){var L=c(C[0]),J=c(C[1]),ee=Math.max(C[0].length,C[1].length),q=C.length==3?Math.abs(c(C[2])):1,re=x,se=J<L;se&&(q*=-1,re=N);var ie=C.some(w);P=[];for(var j=L;re(j,J);j+=q){var k;if(T)k=String.fromCharCode(j),k==="\\"&&(k="");else if(k=String(j),ie){var G=ee-k.length;if(G>0){var S=new Array(G+1).join("0");j<0?k="-"+S+k.slice(1):k=S+k}}P.push(k)}}else{P=[];for(var _=0;_<C.length;_++)P.push.apply(P,I(C[_],!1))}for(var _=0;_<P.length;_++)for(var D=0;D<A.length;D++){var $=O+P[_]+A[D];(!R||W||$)&&B.push($)}}return B}return st}var tr=er();const rr=kt(tr),ir={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Te=l=>l.replace(/[[\]\\-]/g,"\\$&"),nr=l=>l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Et=l=>l.join(""),or=(l,e)=>{const t=e;if(l.charAt(t)!=="[")throw new Error("not in a brace expression");const r=[],n=[];let o=t+1,c=!1,a=!1,h=!1,p=!1,g=t,E="";e:for(;o<l.length;){const I=l.charAt(o);if((I==="!"||I==="^")&&o===t+1){p=!0,o++;continue}if(I==="]"&&c&&!h){g=o+1;break}if(c=!0,I==="\\"&&!h){h=!0,o++;continue}if(I==="["&&!h){for(const[F,[R,B,v]]of Object.entries(ir))if(l.startsWith(F,o)){if(E)return["$.",!1,l.length-t,!0];o+=F.length,v?n.push(R):r.push(R),a=a||B;continue e}}if(h=!1,E){I>E?r.push(Te(E)+"-"+Te(I)):I===E&&r.push(Te(I)),E="",o++;continue}if(l.startsWith("-]",o+1)){r.push(Te(I+"-")),o+=2;continue}if(l.startsWith("-",o+1)){E=I,o+=2;continue}r.push(Te(I)),o++}if(g<o)return["",!1,0,!1];if(!r.length&&!n.length)return["$.",!1,l.length-t,!0];if(n.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!p){const I=r[0].length===2?r[0].slice(-1):r[0];return[nr(I),!1,g-t,!1]}const w="["+(p?"^":"")+Et(r)+"]",x="["+(p?"":"^")+Et(n)+"]";return[r.length&&n.length?"("+w+"|"+x+")":r.length?w:x,a,g-t,!0]},sr=(l,{windowsPathsNoEscape:e=!1}={})=>e?l.replace(/[?*()[\]]/g,"[$&]"):l.replace(/[?*()[\]\\]/g,"\\$&"),lr=(l,{windowsPathsNoEscape:e=!1}={})=>e?l.replace(/\[([^\/\\])\]/g,"$1"):l.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var lt={};const ce=(l,e,t={})=>(Qe(e),!t.nocomment&&e.charAt(0)==="#"?!1:new tt(e,t).match(l)),ar=/^\*+([^+@!?\*\[\(]*)$/,cr=l=>e=>!e.startsWith(".")&&e.endsWith(l),ur=l=>e=>e.endsWith(l),fr=l=>(l=l.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(l)),hr=l=>(l=l.toLowerCase(),e=>e.toLowerCase().endsWith(l)),dr=/^\*+\.\*+$/,pr=l=>!l.startsWith(".")&&l.includes("."),mr=l=>l!=="."&&l!==".."&&l.includes("."),gr=/^\.\*+$/,yr=l=>l!=="."&&l!==".."&&l.startsWith("."),wr=/^\*+$/,_r=l=>l.length!==0&&!l.startsWith("."),Er=l=>l.length!==0&&l!=="."&&l!=="..",xr=/^\?+([^+@!?\*\[\(]*)?$/,br=([l,e=""])=>{const t=Dt([l]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},Ir=([l,e=""])=>{const t=Tt([l]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},vr=([l,e=""])=>{const t=Tt([l]);return e?r=>t(r)&&r.endsWith(e):t},Pr=([l,e=""])=>{const t=Dt([l]);return e?r=>t(r)&&r.endsWith(e):t},Dt=([l])=>{const e=l.length;return t=>t.length===e&&!t.startsWith(".")},Tt=([l])=>{const e=l.length;return t=>t.length===e&&t!=="."&&t!==".."},Ut=typeof process=="object"&&process?typeof lt=="object"&&lt&&lt.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",xt={win32:{sep:"\\"},posix:{sep:"/"}},Fr=Ut==="win32"?xt.win32.sep:xt.posix.sep;ce.sep=Fr;const pe=Symbol("globstar **");ce.GLOBSTAR=pe;const bt={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},ft="[^/]",at=ft+"*?",Sr="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Br="(?:(?!(?:\\/|^)\\.).)*?",$t=l=>l.split("").reduce((e,t)=>(e[t]=!0,e),{}),Rr=$t("().*{}+?[]^$\\!"),Ar=$t("[.("),Nr=(l,e={})=>t=>ce(t,l,e);ce.filter=Nr;const ge=(l,e={})=>Object.assign({},l,e),Or=l=>{if(!l||typeof l!="object"||!Object.keys(l).length)return ce;const e=ce;return Object.assign((r,n,o={})=>e(r,n,ge(l,o)),{Minimatch:class extends e.Minimatch{constructor(n,o={}){super(n,ge(l,o))}static defaults(n){return e.defaults(ge(l,n)).Minimatch}},unescape:(r,n={})=>e.unescape(r,ge(l,n)),escape:(r,n={})=>e.escape(r,ge(l,n)),filter:(r,n={})=>e.filter(r,ge(l,n)),defaults:r=>e.defaults(ge(l,r)),makeRe:(r,n={})=>e.makeRe(r,ge(l,n)),braceExpand:(r,n={})=>e.braceExpand(r,ge(l,n)),match:(r,n,o={})=>e.match(r,n,ge(l,o)),sep:e.sep,GLOBSTAR:pe})};ce.defaults=Or;const jt=(l,e={})=>(Qe(l),e.nobrace||!/\{(?:(?!\{).)*\}/.test(l)?[l]:rr(l));ce.braceExpand=jt;const Lr=1024*64,Qe=l=>{if(typeof l!="string")throw new TypeError("invalid pattern");if(l.length>Lr)throw new TypeError("pattern is too long")},Mr=(l,e={})=>new tt(l,e).makeRe();ce.makeRe=Mr;const Cr=(l,e,t={})=>{const r=new tt(e,t);return l=l.filter(n=>r.match(n)),r.options.nonull&&!l.length&&l.push(e),l};ce.match=Cr;const kr=l=>l.replace(/\\(.)/g,"$1"),It=/[?*]|[+@!]\(.*?\)|\[|\]/,vt=l=>l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class tt{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){Qe(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||Ut,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...o)=>console.error(...o)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(o=>this.slashSplit(o));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let n=this.globParts.map((o,c,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){const h=o[0]===""&&o[1]===""&&(o[2]==="?"||!It.test(o[2]))&&!It.test(o[3]),p=/^[a-z]:/i.test(o[0]);if(h)return[...o.slice(0,4),...o.slice(4).map(g=>this.parse(g))];if(p)return[o[0],...o.slice(1).map(g=>this.parse(g))]}return o.map(h=>this.parse(h))});if(this.debug(this.pattern,n),this.set=n.filter(o=>o.indexOf(!1)===-1),this.isWindows)for(let o=0;o<this.set.length;o++){const c=this.set[o];c[0]===""&&c[1]===""&&this.globParts[o][2]==="?"&&typeof c[3]=="string"&&/^[a-z]:$/i.test(c[3])&&(c[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)e[r][n]==="**"&&(e[r][n]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let r=-1;for(;(r=t.indexOf("**",r+1))!==-1;){let n=r;for(;t[n+1]==="**";)n++;n!==r&&t.splice(r,n-r)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((r,n)=>{const o=r[r.length-1];return n==="**"&&o==="**"?r:n===".."&&o&&o!==".."&&o!=="."&&o!=="**"?(r.pop(),r):(r.push(n),r)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let n=1;n<e.length-1;n++){const o=e[n];n===1&&o===""&&e[0]===""||(o==="."||o==="")&&(t=!0,e.splice(n,1),n--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){const n=e[r-1];n&&n!=="."&&n!==".."&&n!=="**"&&(t=!0,e.splice(r-1,2),r-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let r of e){let n=-1;for(;(n=r.indexOf("**",n+1))!==-1;){let c=n;for(;r[c+1]==="**";)c++;c>n&&r.splice(n+1,c-n);let a=r[n+1];const h=r[n+2],p=r[n+3];if(a!==".."||!h||h==="."||h===".."||!p||p==="."||p==="..")continue;t=!0,r.splice(n,1);const g=r.slice(0);g[n]="**",e.push(g),n--}if(!this.preserveMultipleSlashes){for(let c=1;c<r.length-1;c++){const a=r[c];c===1&&a===""&&r[0]===""||(a==="."||a==="")&&(t=!0,r.splice(c,1),c--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(t=!0,r.pop())}let o=0;for(;(o=r.indexOf("..",o+1))!==-1;){const c=r[o-1];if(c&&c!=="."&&c!==".."&&c!=="**"){t=!0;const h=o===1&&r[o+1]==="**"?["."]:[];r.splice(o-1,2,...h),r.length===0&&r.push(""),o-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){const n=this.partsMatch(e[t],e[r],!this.preserveMultipleSlashes);n&&(e[t]=n,e[r]=[])}return e.filter(t=>t.length)}partsMatch(e,t,r=!1){let n=0,o=0,c=[],a="";for(;n<e.length&&o<t.length;)if(e[n]===t[o])c.push(a==="b"?t[o]:e[n]),n++,o++;else if(r&&e[n]==="**"&&t[o]===e[n+1])c.push(e[n]),n++;else if(r&&t[o]==="**"&&e[n]===t[o+1])c.push(t[o]),o++;else if(e[n]==="*"&&t[o]&&(this.options.dot||!t[o].startsWith("."))&&t[o]!=="**"){if(a==="b")return!1;a="a",c.push(e[n]),n++,o++}else if(t[o]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(a==="a")return!1;a="b",c.push(t[o]),n++,o++}else return!1;return e.length===t.length&&c}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,r=0;for(let n=0;n<e.length&&e.charAt(n)==="!";n++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t,r=!1){const n=this.options;if(this.isWindows){const I=e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),F=t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]);if(I&&F){const R=e[3],B=t[3];R.toLowerCase()===B.toLowerCase()&&(e[3]=B)}else if(F&&typeof e[0]=="string"){const R=t[3],B=e[0];R.toLowerCase()===B.toLowerCase()&&(t[3]=B,t=t.slice(3))}else if(I&&typeof t[0]=="string"){const R=e[3];R.toLowerCase()===t[0].toLowerCase()&&(t[0]=R,e=e.slice(3))}}const{optimizationLevel:o=1}=this.options;o>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var c=0,a=0,h=e.length,p=t.length;c<h&&a<p;c++,a++){this.debug("matchOne loop");var g=t[a],E=e[c];if(this.debug(t,g,E),g===!1)return!1;if(g===pe){this.debug("GLOBSTAR",[t,g,E]);var w=c,x=a+1;if(x===p){for(this.debug("** at the end");c<h;c++)if(e[c]==="."||e[c]===".."||!n.dot&&e[c].charAt(0)===".")return!1;return!0}for(;w<h;){var N=e[w];if(this.debug(`
globstar while`,e,w,t,x,N),this.matchOne(e.slice(w),t.slice(x),r))return this.debug("globstar found match!",w,h,N),!0;if(N==="."||N===".."||!n.dot&&N.charAt(0)==="."){this.debug("dot detected!",e,w,t,x);break}this.debug("globstar swallow a segment, and continue"),w++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,w,t,x),w===h))}let I;if(typeof g=="string"?(I=E===g,this.debug("string match",g,E,I)):(I=g.test(E),this.debug("pattern match",g,E,I)),!I)return!1}if(c===h&&a===p)return!0;if(c===h)return r;if(a===p)return c===h-1&&e[c]==="";throw new Error("wtf?")}braceExpand(){return jt(this.pattern,this.options)}parse(e){Qe(e);const t=this.options;if(e==="**")return pe;if(e==="")return"";let r,n=null;(r=e.match(wr))?n=t.dot?Er:_r:(r=e.match(ar))?n=(t.nocase?t.dot?hr:fr:t.dot?ur:cr)(r[1]):(r=e.match(xr))?n=(t.nocase?t.dot?Ir:br:t.dot?vr:Pr)(r):(r=e.match(dr))?n=t.dot?mr:pr:(r=e.match(gr))&&(n=yr);let o="",c=!1,a=!1;const h=[],p=[];let g=!1,E=!1,w,x=e.charAt(0)===".",N=t.dot||x;const I=()=>x?"":N?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",F=O=>O.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",R=()=>{if(g){switch(g){case"*":o+=at,c=!0;break;case"?":o+=ft,c=!0;break;default:o+="\\"+g;break}this.debug("clearStateChar %j %j",g,o),g=!1}};for(let O=0,A;O<e.length&&(A=e.charAt(O));O++){if(this.debug("%s	%s %s %j",e,O,o,A),a){if(A==="/")return!1;Rr[A]&&(o+="\\"),o+=A,a=!1;continue}switch(A){case"/":return!1;case"\\":R(),a=!0;continue;case"?":case"*":case"+":case"@":case"!":this.debug("%s	%s %s %j <-- stateChar",e,O,o,A),this.debug("call clearStateChar %j",g),R(),g=A,t.noext&&R();continue;case"(":{if(!g){o+="\\(";continue}const W={type:g,start:O-1,reStart:o.length,open:bt[g].open,close:bt[g].close};this.debug(this.pattern,"	",W),h.push(W),o+=W.open,W.start===0&&W.type!=="!"&&(x=!0,o+=F(e.slice(O+1))),this.debug("plType %j %j",g,o),g=!1;continue}case")":{const W=h[h.length-1];if(!W){o+="\\)";continue}h.pop(),R(),c=!0,w=W,o+=w.close,w.type==="!"&&p.push(Object.assign(w,{reEnd:o.length}));continue}case"|":{const W=h[h.length-1];if(!W){o+="\\|";continue}R(),o+="|",W.start===0&&W.type!=="!"&&(x=!0,o+=F(e.slice(O+1)));continue}case"[":R();const[D,$,H,T]=or(e,O);H?(o+=D,E=E||$,O+=H-1,c=c||T):o+="\\[";continue;case"]":o+="\\"+A;continue;default:R(),o+=vt(A);break}}for(w=h.pop();w;w=h.pop()){let O;O=o.slice(w.reStart+w.open.length),this.debug(this.pattern,"setting tail",o,w),O=O.replace(/((?:\\{2}){0,64})(\\?)\|/g,(D,$,H)=>(H||(H="\\"),$+$+H+"|")),this.debug(`tail=%j
   %s`,O,O,w,o);const A=w.type==="*"?at:w.type==="?"?ft:"\\"+w.type;c=!0,o=o.slice(0,w.reStart)+A+"\\("+O}R(),a&&(o+="\\\\");const B=Ar[o.charAt(0)];for(let O=p.length-1;O>-1;O--){const A=p[O],D=o.slice(0,A.reStart),$=o.slice(A.reStart,A.reEnd-8);let H=o.slice(A.reEnd);const T=o.slice(A.reEnd-8,A.reEnd)+H,W=D.split(")").length,M=D.split("(").length-W;let C=H;for(let L=0;L<M;L++)C=C.replace(/\)[+*?]?/,"");H=C;const P=H===""?"(?:$|\\/)":"";o=D+$+H+P+T}if(o!==""&&c&&(o="(?=.)"+o),B&&(o=I()+o),t.nocase&&!c&&!t.nocaseMagicOnly&&(c=e.toUpperCase()!==e.toLowerCase()),!c)return kr(o);const v=(t.nocase?"i":"")+(E?"u":"");try{const O=n?{_glob:e,_src:o,test:n}:{_glob:e,_src:o};return Object.assign(new RegExp("^"+o+"$",v),O)}catch(O){return this.debug("invalid regexp",O),new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,r=t.noglobstar?at:t.dot?Sr:Br,n=t.nocase?"i":"";let o=e.map(c=>{const a=c.map(h=>typeof h=="string"?vt(h):h===pe?pe:h._src);return a.forEach((h,p)=>{const g=a[p+1],E=a[p-1];h!==pe||E===pe||(E===void 0?g!==void 0&&g!==pe?a[p+1]="(?:\\/|"+r+"\\/)?"+g:a[p]=r:g===void 0?a[p-1]=E+"(?:\\/|"+r+")?":g!==pe&&(a[p-1]=E+"(?:\\/|\\/"+r+"\\/)"+g,a[p+1]=pe))}),a.filter(h=>h!==pe).join("/")}).join("|");o="^(?:"+o+")$",this.negate&&(o="^(?!"+o+").*$");try{this.regexp=new RegExp(o,n)}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const r=this.options;this.isWindows&&(e=e.split("\\").join("/"));const n=this.slashSplit(e);this.debug(this.pattern,"split",n);const o=this.set;this.debug(this.pattern,"set",o);let c=n[n.length-1];if(!c)for(let a=n.length-2;!c&&a>=0;a--)c=n[a];for(let a=0;a<o.length;a++){const h=o[a];let p=n;if(r.matchBase&&h.length===1&&(p=[c]),this.matchOne(p,h,t))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(e){return ce.defaults(e).Minimatch}}ce.Minimatch=tt;ce.escape=sr;ce.unescape=lr;function rt(l,e){return new RegExp(e).test(l)}function Dr(l,e){const t=e.indexOf("*");return t===-1?l===e:l.length>t?l.slice(0,t)===e.slice(0,t):l===e.slice(0,t)}function Tr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Dr(r,n)}function Ur(l,e){const t=e.indexOf("*");return t===-1?"":l.length>t&&l.slice(0,t)===e.slice(0,t)?l.slice(t,l.length):""}function $r(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Ur(r,n)}function qt(l,e){e=e.replace(/\/\*/g,"/.*");const t=new RegExp(/(.*):[^/]+(.*)/g);for(;e.includes("/:");)e=e.replace(t,"$1[^/]+$2");return e==="*"&&(e="(.*)"),rt(l,"^"+e+"$")}function jr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return qt(r,n)}function qr(l,e,t){if(qt(l,e)){const r=new RegExp("[^/]+","g"),n=e.match(r),o=l.match(r);if(!n||!o)return"";const c=n.indexOf(`:${t}`);return c===-1?"":o[c]}else return""}function Wr(...l){const[e,t,r]=l,n=(e||"").toString(),o=(t||"").toString(),c=(r||"").toString();return qr(n,o,c)}function Gr(l,e){e=e.replace(/\/\*/g,"/.*");const t=new RegExp(/(.*){[^/]+}(.*)/g);for(;e.includes("/{");)e=e.replace(t,"$1[^/]+$2");return rt(l,"^"+e+"$")}function Vr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Gr(r,n)}function Jr(l,e){e=e.replace(/\/\*/g,"/.*");const t=[];let r=-1;for(let a=0;a<e.length;a++){const h=e.charAt(a);h==="{"?r=a:h==="}"&&t.push(e.substring(r,a+1))}let n=new RegExp(/(.*){[^/]+}(.*)/g);for(;e.includes("/{");)e=e.replace(n,"$1([^/]+)$2");n=new RegExp("^"+e+"$");let o=n.exec(l);if(!o)return!1;if(o=o.slice(1),t.length!==o.length)throw new Error("KeyMatch4: number of tokens is not equal to number of values");const c=new Map;t.forEach((a,h)=>{const p=t[h];let g=c.get(p);g||(g=[]),o&&g.push(o[h]),c.set(p,g)});for(const a of c.values())if(a.length>1){for(let h=1;h<o.length;h++)if(o[h]!==o[0])return!1}return!0}function zr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Jr(r,n)}function Hr(l,e){const t=l.indexOf("?");t!==-1&&(l=l.slice(0,t)),e=e.replace(/\/\*/g,"/.*");const r=new RegExp(/(.*){[^/]+}(.*)/g);for(;e.includes("/{");)e=e.replace(r,"$1[^/]+$2");return rt(l,"^"+e+"$")}function Qr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Hr(r,n)}function Yr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return rt(r,n)}function Xr(l,e){if(!(ne.isV4Format(l)||ne.isV6Format(l)))throw new Error("invalid argument: ip1 in ipMatch() function is not an IP address.");if(e.split("/").length===2)return ne.cidrSubnet(e).contains(l);if(!(ne.isV4Format(e)||ne.isV6Format(e)))throw console.log(e),new Error("invalid argument: ip2 in ipMatch() function is not an IP address.");return ne.isEqual(l,e)}function Kr(...l){const[e,t]=l,r=(e||"").toString(),n=(t||"").toString();return Xr(r,n)}function Zr(l,e){return e[0]==="*"&&e[1]==="/"&&(e=e.substring(1)),ce(l,e)}function ei(l){const e=new Map;return async function(...t){const r=t.toString();let n=e.get(r);if(n)return n;const[o,c]=t,a=(o||"").toString(),h=(c||"").toString();if(!l)n=a===h;else if(t.length===2)n=await l.hasLink(a,h);else{const p=t[2].toString();n=await l.hasLink(a,h,p)}return e.set(r,n),n}}function ti(l){const e=new Map;return function(...t){const r=t.toString();let n=e.get(r);if(n)return n;const[o,c]=t,a=(o||"").toString(),h=(c||"").toString();if(!l)n=a===h;else if(l?.syncedHasLink)if(t.length===2)n=l.syncedHasLink(a,h);else{const p=t[2].toString();n=l.syncedHasLink(a,h,p)}else throw new Error("RoleManager requires syncedHasLink for synchronous execution");return e.set(r,n),n}}class V extends Error{constructor(e,t,r,...n){Array.isArray(t)&&(t=t.join(" ").trim()),super(t),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,V),this.code=e;for(const o of n)for(const c in o){const a=o[c];this[c]=Buffer.isBuffer(a)?a.toString(r.encoding):a==null?a:JSON.parse(JSON.stringify(a))}}}const ri=function(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)},Wt=function(l){const e=[];for(let t=0,r=l.length;t<r;t++){const n=l[t];if(n==null||n===!1)e[t]={disabled:!0};else if(typeof n=="string")e[t]={name:n};else if(ri(n)){if(typeof n.name!="string")throw new V("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${t}`,"when column is an object literal"]);e[t]=n}else throw new V("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(n)} at position ${t}`])}return e};class Pt{constructor(e=100){this.size=e,this.length=0,this.buf=Buffer.allocUnsafe(e)}prepend(e){if(Buffer.isBuffer(e)){const t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");const r=this.buf;this.buf=Buffer.allocUnsafe(this.size),e.copy(this.buf,0),r.copy(this.buf,e.length),this.length+=e.length}else{const t=this.length++;t===this.size&&this.resize();const r=this.clone();this.buf[0]=e,r.copy(this.buf,1,0,t)}}append(e){const t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const t=Buffer.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const ii=12,ni=13,oi=10,si=32,li=9,ai=function(l){return{bomSkipped:!1,bufBytesStart:0,castField:l.cast_function,commenting:!1,error:void 0,enabled:l.from_line===1,escaping:!1,escapeIsQuote:Buffer.isBuffer(l.escape)&&Buffer.isBuffer(l.quote)&&Buffer.compare(l.escape,l.quote)===0,expectedRecordLength:Array.isArray(l.columns)?l.columns.length:void 0,field:new Pt(20),firstLineToHeaders:l.cast_first_line_to_header,needMoreDataSize:Math.max(l.comment!==null?l.comment.length:0,...l.delimiter.map(e=>e.length),l.quote!==null?l.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new Pt(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:l.record_delimiter.length===0?0:Math.max(...l.record_delimiter.map(e=>e.length)),trimChars:[Buffer.from(" ",l.encoding)[0],Buffer.from("	",l.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([ni],"utf8").toString(),l.encoding),Buffer.from(Buffer.from([oi],"utf8").toString(),l.encoding),Buffer.from(Buffer.from([ii],"utf8").toString(),l.encoding),Buffer.from(Buffer.from([si],"utf8").toString(),l.encoding),Buffer.from(Buffer.from([li],"utf8").toString(),l.encoding)]}},ci=function(l){return l.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})},Ft=function(l){const e={};for(const r in l)e[ci(r)]=l[r];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new V("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new V("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new V("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(r){const n=Date.parse(r);return isNaN(n)?r:new Date(n)};else if(typeof e.cast_date!="function")throw new V("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=Wt(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new V("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new V("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new V("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=Buffer.from(e.comment,e.encoding)),!Buffer.isBuffer(e.comment))throw new V("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new V("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const t=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new V("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);if(e.delimiter=e.delimiter.map(function(r){if(r==null||r===!1)return Buffer.from(",",e.encoding);if(typeof r=="string"&&(r=Buffer.from(r,e.encoding)),!Buffer.isBuffer(r)||r.length===0)throw new V("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);return r}),e.escape===void 0||e.escape===!0?e.escape=Buffer.from('"',e.encoding):typeof e.escape=="string"?e.escape=Buffer.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!Buffer.isBuffer(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(l.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(l.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(l.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new V("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new V("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(Buffer.isBuffer(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new V("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.on_skip!==void 0&&e.on_skip!==null&&typeof e.on_skip!="function")throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(e.on_skip)}`);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=Buffer.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=Buffer.from(e.quote,e.encoding)),!Buffer.isBuffer(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||Buffer.isBuffer(e.record_delimiter)){if(e.record_delimiter.length===0)throw new V("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new V("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(r,n){if(typeof r!="string"&&!Buffer.isBuffer(r))throw new V("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${n},`,`got ${JSON.stringify(r)}`],e);if(r.length===0)throw new V("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${n},`,`got ${JSON.stringify(r)}`],e);return typeof r=="string"&&(r=Buffer.from(r,e.encoding)),r}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&l.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&l.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(l.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(l.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(l.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(l.to_line)}`);return e},St=function(l){return l.every(e=>e==null||e.toString&&e.toString().trim()==="")},ui=13,fi=10,Oe={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},hi=function(l={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},t=Ft(l);return{info:e,original_options:l,options:t,state:ai(t),__needMoreData:function(r,n,o){if(o)return!1;const{encoding:c,escape:a,quote:h}=this.options,{quoting:p,needMoreDataSize:g,recordDelimiterMaxLength:E}=this.state,w=n-r-1,x=Math.max(g,E===0?Buffer.from(`\r
`,c).length:E,p?(a===null?0:a.length)+h.length:0,p?h.length+E:0);return w<x},parse:function(r,n,o,c){const{bom:a,comment_no_infix:h,encoding:p,from_line:g,ltrim:E,max_record_size:w,raw:x,relax_quotes:N,rtrim:I,skip_empty_lines:F,to:R,to_line:B}=this.options;let{comment:v,escape:O,quote:A,record_delimiter:D}=this.options;const{bomSkipped:$,previousBuf:H,rawBuffer:T,escapeIsQuote:W}=this.state;let M;if(H===void 0)if(r===void 0){c();return}else M=r;else H!==void 0&&r===void 0?M=H:M=Buffer.concat([H,r]);if($===!1)if(a===!1)this.state.bomSkipped=!0;else if(M.length<3){if(n===!1){this.state.previousBuf=M;return}}else{for(const L in Oe)if(Oe[L].compare(M,0,Oe[L].length)===0){const J=Oe[L].length;this.state.bufBytesStart+=J,M=M.slice(J),this.options=Ft({...this.original_options,encoding:L}),{comment:v,escape:O,quote:A}=this.options;break}this.state.bomSkipped=!0}const C=M.length;let P;for(P=0;P<C&&!this.__needMoreData(P,C,n);P++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),B!==-1&&this.info.lines>B){this.state.stop=!0,c();return}this.state.quoting===!1&&D.length===0&&this.__autoDiscoverRecordDelimiter(M,P)&&(D=this.options.record_delimiter);const L=M[P];if(x===!0&&T.append(L),(L===ui||L===fi)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(O!==null&&this.state.quoting===!0&&this.__isEscape(M,P,L)&&P+O.length<C)if(W){if(this.__isQuote(M,P+O.length)){this.state.escaping=!0,P+=O.length-1;continue}}else{this.state.escaping=!0,P+=O.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(M,P))if(this.state.quoting===!0){const q=M[P+A.length],re=I&&this.__isCharTrimable(M,P+A.length),se=v!==null&&this.__compareBytes(v,M,P+A.length,q),ie=this.__isDelimiter(M,P+A.length,q),j=D.length===0?this.__autoDiscoverRecordDelimiter(M,P+A.length):this.__isRecordDelimiter(q,M,P+A.length);if(O!==null&&this.__isEscape(M,P,L)&&this.__isQuote(M,P+O.length))P+=O.length-1;else if(!q||ie||j||se||re){this.state.quoting=!1,this.state.wasQuoting=!0,P+=A.length-1;continue}else if(N===!1){const k=this.__error(new V("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(q)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(k!==void 0)return k}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(A),P+=A.length-1}else if(this.state.field.length!==0){if(N===!1){const q=this.__infoField(),re=Object.keys(Oe).map(ie=>Oe[ie].equals(this.state.field.toString())?ie:!1).filter(Boolean)[0],se=this.__error(new V("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(q.column)} at line ${q.lines}, value is ${JSON.stringify(this.state.field.toString(p))}`,re?`(${re} bom)`:void 0],this.options,q,{field:this.state.field}));if(se!==void 0)return se}}else{this.state.quoting=!0,P+=A.length-1;continue}if(this.state.quoting===!1){const q=this.__isRecordDelimiter(L,M,P);if(q!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=g){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),P+=q-1;continue}if(F===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,P+=q-1;continue}this.info.bytes=this.state.bufBytesStart+P;const ie=this.__onField();if(ie!==void 0)return ie;this.info.bytes=this.state.bufBytesStart+P+q;const j=this.__onRecord(o);if(j!==void 0)return j;if(R!==-1&&this.info.records>=R){this.state.stop=!0,c();return}}this.state.commenting=!1,P+=q-1;continue}if(this.state.commenting)continue;if(v!==null&&(h===!1||this.state.record.length===0&&this.state.field.length===0)&&this.__compareBytes(v,M,P,L)!==0){this.state.commenting=!0;continue}const re=this.__isDelimiter(M,P,L);if(re!==0){this.info.bytes=this.state.bufBytesStart+P;const se=this.__onField();if(se!==void 0)return se;P+=re-1;continue}}}if(this.state.commenting===!1&&w!==0&&this.state.record_length+this.state.field.length>w)return this.__error(new V("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${w}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const J=E===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(M,P),ee=I===!1||this.state.wasQuoting===!1;if(J===!0&&ee===!0)this.state.field.append(L);else{if(I===!0&&!this.__isCharTrimable(M,P))return this.__error(new V("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));J===!1&&(P+=this.__isCharTrimable(M,P)-1);continue}}if(n===!0)if(this.state.quoting===!0){const L=this.__error(new V("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(L!==void 0)return L}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+P;const L=this.__onField();if(L!==void 0)return L;const J=this.__onRecord(o);if(J!==void 0)return J}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=P,this.state.previousBuf=M.slice(P);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(r){const{columns:n,group_columns_by_name:o,encoding:c,info:a,from:h,relax_column_count:p,relax_column_count_less:g,relax_column_count_more:E,raw:w,skip_records_with_empty_values:x}=this.options,{enabled:N,record:I}=this.state;if(N===!1)return this.__resetRecord();const F=I.length;if(n===!0){if(x===!0&&St(I)){this.__resetRecord();return}return this.__firstLineToColumns(I)}if(n===!1&&this.info.records===0&&(this.state.expectedRecordLength=F),F!==this.state.expectedRecordLength){const R=n===!1?new V("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${F} on line ${this.info.lines}`],this.options,this.__infoField(),{record:I}):new V("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${n.length},`,`got ${F} on line ${this.info.lines}`],this.options,this.__infoField(),{record:I});if(p===!0||g===!0&&F<this.state.expectedRecordLength||E===!0&&F>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=R;else{const B=this.__error(R);if(B)return B}}if(x===!0&&St(I)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,h===1||this.info.records>=h){const{objname:R}=this.options;if(n!==!1){const B={};for(let v=0,O=I.length;v<O;v++)n[v]===void 0||n[v].disabled||(o===!0&&B[n[v].name]!==void 0?Array.isArray(B[n[v].name])?B[n[v].name]=B[n[v].name].concat(I[v]):B[n[v].name]=[B[n[v].name],I[v]]:B[n[v].name]=I[v]);if(w===!0||a===!0){const v=Object.assign({record:B},w===!0?{raw:this.state.rawBuffer.toString(c)}:{},a===!0?{info:this.__infoRecord()}:{}),O=this.__push(R===void 0?v:[B[R],v],r);if(O)return O}else{const v=this.__push(R===void 0?B:[B[R],B],r);if(v)return v}}else if(w===!0||a===!0){const B=Object.assign({record:I},w===!0?{raw:this.state.rawBuffer.toString(c)}:{},a===!0?{info:this.__infoRecord()}:{}),v=this.__push(R===void 0?B:[I[R],B],r);if(v)return v}else{const B=this.__push(R===void 0?I:[I[R],I],r);if(B)return B}}this.__resetRecord()},__firstLineToColumns:function(r){const{firstLineToHeaders:n}=this.state;try{const o=n===void 0?r:n.call(null,r);if(!Array.isArray(o))return this.__error(new V("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(o)}`],this.options,this.__infoField(),{headers:o}));const c=Wt(o);this.state.expectedRecordLength=c.length,this.options.columns=c,this.__resetRecord();return}catch(o){return o}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:r,encoding:n,rtrim:o,max_record_size:c}=this.options,{enabled:a,wasQuoting:h}=this.state;if(a===!1)return this.__resetField();let p=this.state.field.toString(n);if(o===!0&&h===!1&&(p=p.trimRight()),r===!0){const[g,E]=this.__cast(p);if(g!==void 0)return g;p=E}this.state.record.push(p),c!==0&&typeof p=="string"&&(this.state.record_length+=p.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(r,n){const{on_record:o}=this.options;if(o!==void 0){const c=this.__infoRecord();try{r=o.call(null,r,c)}catch(a){return a}if(r==null)return}n(r)},__cast:function(r){const{columns:n,relax_column_count:o}=this.options;if(Array.isArray(n)===!0&&o&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const a=this.__infoField();return[void 0,this.state.castField.call(null,r,a)]}catch(a){return[a]}if(this.__isFloat(r))return[void 0,parseFloat(r)];if(this.options.cast_date!==!1){const a=this.__infoField();return[void 0,this.options.cast_date.call(null,r,a)]}return[void 0,r]},__isCharTrimable:function(r,n){return((c,a)=>{const{timchars:h}=this.state;e:for(let p=0;p<h.length;p++){const g=h[p];for(let E=0;E<g.length;E++)if(g[E]!==c[a+E])continue e;return g.length}return 0})(r,n)},__isFloat:function(r){return r-parseFloat(r)+1>=0},__compareBytes:function(r,n,o,c){if(r[0]!==c)return 0;const a=r.length;for(let h=1;h<a;h++)if(r[h]!==n[o+h])return 0;return a},__isDelimiter:function(r,n,o){const{delimiter:c,ignore_last_delimiters:a}=this.options;if(a===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(a!==!1&&typeof a=="number"&&this.state.record.length===a-1)return 0;e:for(let h=0;h<c.length;h++){const p=c[h];if(p[0]===o){for(let g=1;g<p.length;g++)if(p[g]!==r[n+g])continue e;return p.length}}return 0},__isRecordDelimiter:function(r,n,o){const{record_delimiter:c}=this.options,a=c.length;e:for(let h=0;h<a;h++){const p=c[h],g=p.length;if(p[0]===r){for(let E=1;E<g;E++)if(p[E]!==n[o+E])continue e;return p.length}}return 0},__isEscape:function(r,n,o){const{escape:c}=this.options;if(c===null)return!1;const a=c.length;if(c[0]===o){for(let h=0;h<a;h++)if(c[h]!==r[n+h])return!1;return!0}return!1},__isQuote:function(r,n){const{quote:o}=this.options;if(o===null)return!1;const c=o.length;for(let a=0;a<c;a++)if(o[a]!==r[n+a])return!1;return!0},__autoDiscoverRecordDelimiter:function(r,n){const{encoding:o}=this.options,c=[Buffer.from(`\r
`,o),Buffer.from(`
`,o),Buffer.from("\r",o)];e:for(let a=0;a<c.length;a++){const h=c[a].length;for(let p=0;p<h;p++)if(c[a][p]!==r[n+p])continue e;return this.options.record_delimiter.push(c[a]),this.state.recordDelimiterMaxLength=c[a].length,c[a].length}return 0},__error:function(r){const{encoding:n,raw:o,skip_records_with_error:c}=this.options,a=typeof r=="string"?new Error(r):r;if(c){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(a,o?this.state.rawBuffer.toString(n):void 0);return}else return a},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:r,raw:n,encoding:o}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:r===!0,index:this.state.record.length,raw:n?this.state.rawBuffer.toString(o):void 0}},__infoField:function(){const{columns:r}=this.options,n=Array.isArray(r);return{...this.__infoRecord(),column:n===!0?r.length>this.state.record.length?r[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},di=function(l,e={}){typeof l=="string"&&(l=Buffer.from(l));const t=e&&e.objname?{}:[],r=hi(e),n=h=>{r.options.objname===void 0?t.push(h):t[h[0]]=h[1]},o=()=>{},c=r.parse(l,!1,n,o);if(c!==void 0)throw c;const a=r.parse(void 0,!0,n,o);if(a!==void 0)throw a;return t};class pi{parse(e){return!e||e.trimStart().charAt(0)==="#"?null:di(e,{delimiter:",",skip_empty_lines:!0,trim:!0,relax_quotes:!0})}}class mi{constructor(e=new pi){this.baseParser=e}parse(e){const t=this.baseParser.parse(e);if(!t||!t[0])return null;const r=t[0],n=[];let o="",c=0;for(const a of r){for(const h of a)h==="("?c++:h===")"&&c--;o+=(o?",":"")+a,c===0&&(n.push(o),o="")}if(c!==0)throw new Error(`Unmatched brackets in policy line: ${e}`);return n.length>0?[n]:null}}class gi{constructor(e=new mi){this.parser=e}loadPolicyLine(e,t){const r=this.parser.parse(e);if(!r||!r[0])return;let n=r[0][0].trim();n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1));const o=n.substring(0,1),c=t.model.get(o);if(!c)return;const a=c.get(n);if(!a)return;const h=r[0].slice(1).map(p=>(p.startsWith('"')&&p.endsWith('"')&&(p=p.slice(1,-1)),p.replace(/""/g,'"').trim()));a.policy.push(h)}}class $e{static loadPolicyLine(e,t){$e.policyLoader.loadPolicyLine(e,t)}}$e.policyLoader=new gi;let Ye;const yi=new Error("please set the default FileSystem by call the setDefaultFileSystem"),wi=l=>{Ye=l},_i=()=>Ye,ht=()=>{if(Ye)return Ye;throw yi};class Ei{constructor(e,t){this.filePath=e,this.fs=t}async loadPolicy(e){this.filePath&&await this.loadPolicyFile(e,$e.loadPolicyLine)}async loadPolicyFile(e,t){(await(this.fs?this.fs:ht()).readFileSync(this.filePath)).toString().split(`
`).forEach(o=>{!o||o.trim().startsWith("#")||t(o,e)})}async savePolicy(e){if(!this.filePath)return!1;let t="";const r=e.model.get("p");if(!r)return!1;r.forEach(o=>{o.policy.forEach(c=>{t+=o.key+", ",t+=Bt(c),t+=`
`})});const n=e.model.get("g");return n?(n.forEach(o=>{o.policy.forEach(c=>{t+=o.key+", ",t+=Bt(c.map(a=>this.escapeCsv(a))),t+=`
`})}),await this.savePolicyFile(t.trim()),!0):!1}escapeCsv(e){return e.includes(",")?`"${e.replace(/"/g,'""')}"`:e}async savePolicyFile(e){(this.fs?this.fs:ht()).writeFileSync(this.filePath,e)}async addPolicy(e,t,r){throw new Error("not implemented")}async addPolicies(e,t,r){throw new Error("not implemented")}updatePolicy(e,t,r,n){throw new Error("not implemented")}async removePolicy(e,t,r){throw new Error("not implemented")}async removePolicies(e,t,r){throw new Error("not implemented")}async removeFilteredPolicy(e,t,r,...n){throw new Error("not implemented")}}class xi{constructor(e){this.policy=e}async loadPolicy(e){if(!this.policy)throw new Error("Invalid policy, policy document cannot be false-y");await this.loadRules(e,$e.loadPolicyLine)}async loadRules(e,t){this.policy.split(`
`).forEach((n,o)=>{n&&t(n,e)})}async savePolicy(e){throw new Error("not implemented")}async addPolicy(e,t,r){throw new Error("not implemented")}async removePolicy(e,t,r){throw new Error("not implemented")}async removeFilteredPolicy(e,t,r,...n){throw new Error("not implemented")}}const bi=new RegExp(/([()\s|&,=!><+\-*/]|^)((r|p)[0-9]*)\./g);function Xe(l){return l=l.replace(bi,e=>{const t=e.lastIndexOf(".");return t>0?e.substring(0,t)+"_":e}),l}function Ii(l){const e=l.indexOf("#");return e>-1?l.slice(0,e).trim():l}function Je(l=[],e=[]){const t=l.length,r=e.length;if(t!==r)return!1;for(let n=0;n<t;n++)if(l[n]!==e[n])return!1;return!0}function Ke(l){return[...new Set(l)]}function Bt(l){return l.join(", ")}const vi=new RegExp(/\beval\(([^),]*)\)/g),Pi=new RegExp(/\beval\(([^),]*)\)/);function Fi(l){return Pi.test(l)}function Si(l,e,t){return l.replace(`eval(${e})`,"("+t+")")}function Bi(l){const e=l.match(vi),t=[];if(!e)return[];for(const r of e){const n=r.indexOf("(");t.push(r.slice(n+1,-1))}return t}function ze(l){let{value:e,done:t}=l.next();for(;;){if(e instanceof Promise)throw new Error("cannot handle Promise in generatorRunSync, Please use generatorRunAsync");if(t)return e;{const r=e;({value:e,done:t}=l.next(r))}}}async function ve(l){let{value:e,done:t}=l.next();for(;;){if(t)return e;{const r=await e;({value:e,done:t}=l.next(r))}}}function Ri(l,e){return e instanceof Array?e.includes(l):l in e}function Ai(l){if(!(l.includes(" in ")&&l.includes(" (")))return l;const e=/ \([^)]*\)/g,t=l.split("");let r;for(;(r=e.exec(l))!==null;)r[0].includes(",")&&(t[r.index+1]="[",t[e.lastIndex-1]="]");return l=t.join(""),l}class ue{constructor(e){this.data=new Map,e&&(this.fs=e)}static newConfig(e){return this.newConfigFromFile(e)}static newConfigFromFile(e,t){const r=new ue(t);return r.parse(e),r}static newConfigFromText(e){const t=new ue;return t.parseBuffer(Buffer.from(e)),t}addConfig(e,t,r){e===""&&(e=ue.DEFAULT_SECTION),this.data.has(e)||this.data.set(e,new Map);const o=this.data.get(e);return o?(o.set(t,r),o.has(t)):!1}parse(e){const t=(this.fs?this.fs:ht()).readFileSync(e);this.parseBuffer(Buffer.isBuffer(t)?t:Buffer.from(t))}parseBuffer(e){const t=e.toString().split(`
`).filter(a=>a),r=t.length;let n="",o="";const c=new Set;t.forEach((a,h)=>{let p=a.indexOf(ue.DEFAULT_COMMENT);p>-1&&(a=a.slice(0,p)),p=a.indexOf(ue.DEFAULT_COMMENT_SEM),p>-1&&(a=a.slice(0,p));const g=a.trim();if(!g)return;const E=h+1;if(g.startsWith("[")&&g.endsWith("]")){if(o.length!==0&&(this.write(n,E-1,o),o=""),n=g.substring(1,g.length-1),c.has(n))throw new Error(`Duplicated section: ${n} at line ${E}`);c.add(n)}else{let w=!1;g.endsWith(ue.DEFAULT_MULTI_LINE_SEPARATOR)?o+=g.substring(0,g.length-1).trim():(o+=g,w=!0),(w||E===r)&&(this.write(n,E,o),o="")}})}write(e,t,r){const n=r.indexOf("=");if(n===-1)throw new Error(`parse the content error : line ${t}`);const o=r.substring(0,n),c=r.substring(n+1);this.addConfig(e,o.trim(),c.trim())}getBool(e){return!!this.get(e)}getInt(e){return Number.parseInt(this.get(e),10)}getFloat(e){return Number.parseFloat(this.get(e))}getString(e){return this.get(e)}getStrings(e){return this.get(e).split(",")}set(e,t){if(!e)throw new Error("key is empty");let r="",n;const o=e.toLowerCase().split("::");o.length>=2?(r=o[0],n=o[1]):n=o[0],this.addConfig(r,n,t)}get(e){let t,r;const n=e.toLowerCase().split("::");n.length>=2?(t=n[0],r=n[1]):(t=ue.DEFAULT_SECTION,r=n[0]);const o=this.data.get(t),c=o&&o.get(r);return c||""}}ue.DEFAULT_SECTION="default";ue.DEFAULT_COMMENT="#";ue.DEFAULT_COMMENT_SEM=";";ue.DEFAULT_MULTI_LINE_SEPARATOR="\\";const Ni="modulepreload",Oi=function(l){return"/"+l},Rt={},Li=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let h=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(E=>({status:"fulfilled",value:E}),E=>({status:"rejected",reason:E}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");n=h(t.map(p=>{if(p=Oi(p),p in Rt)return;Rt[p]=!0;const g=p.endsWith(".css"),E=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${E}`))return;const w=document.createElement("link");if(w.rel=g?"stylesheet":Ni,g||(w.as="script"),w.crossOrigin="",w.href=p,a&&w.setAttribute("nonce",a),document.head.appendChild(w),g)return new Promise((x,N)=>{w.addEventListener("load",x),w.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(c){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c}return n.then(c=>{for(const a of c||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};var He={exports:{}},At;function Mi(){return At||(At=1,(function(l,e){(function(t){var r="Compound",n="Identifier",o="MemberExpression",c="Literal",a="ThisExpression",h="CallExpression",p="UnaryExpression",g="BinaryExpression",E="LogicalExpression",w="ConditionalExpression",x="ArrayExpression",N=46,I=44,F=39,R=34,B=40,v=41,O=91,A=93,D=63,$=59,H=58,T=function(S,_){var ae=new Error(S+" at character "+_);throw ae.index=_,ae.description=S,ae},W=!0,M={"-":W,"!":W,"~":W,"+":W},C={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},P=function(S){var _=0,ae;for(var we in S)(ae=we.length)>_&&S.hasOwnProperty(we)&&(_=ae);return _},L=P(M),J=P(C),ee={true:!0,false:!1,null:null},q="this",re=function(S){return C[S]||0},se=function(S,_,ae){var we=S==="||"||S==="&&"?E:g;return{type:we,operator:S,left:_,right:ae}},ie=function(S){return S>=48&&S<=57},j=function(S){return S===36||S===95||S>=65&&S<=90||S>=97&&S<=122||S>=128&&!C[String.fromCharCode(S)]},k=function(S){return S===36||S===95||S>=65&&S<=90||S>=97&&S<=122||S>=48&&S<=57||S>=128&&!C[String.fromCharCode(S)]},G=function(S){for(var _=0,ae=S.charAt,we=S.charCodeAt,X=function(b){return ae.call(S,b)},z=function(b){return we.call(S,b)},be=S.length,he=function(){for(var b=z(_);b===32||b===9||b===10||b===13;)b=z(++_)},_e=function(){var b=Se(),u,i;if(he(),z(_)===D){if(_++,u=_e(),u||T("Expected expression",_),he(),z(_)===H)return _++,i=_e(),i||T("Expected expression",_),{type:w,test:b,consequent:u,alternate:i};T("Expected :",_)}else return b},Ee=function(){he();for(var b=S.substr(_,J),u=b.length;u>0;){if(C.hasOwnProperty(b)&&(!j(z(_))||_+b.length<S.length&&!k(z(_+b.length))))return _+=u,b;b=b.substr(0,--u)}return!1},Se=function(){var b,u,i,s,f,d,m,y,U;if(d=Ae(),u=Ee(),!u)return d;for(f={value:u,prec:re(u)},m=Ae(),m||T("Expected expression after "+u,_),s=[d,f,m];(u=Ee())&&(i=re(u),i!==0);){for(f={value:u,prec:i},U=u;s.length>2&&i<=s[s.length-2].prec;)m=s.pop(),u=s.pop().value,d=s.pop(),b=se(u,d,m),s.push(b);b=Ae(),b||T("Expected expression after "+U,_),s.push(f,b)}for(y=s.length-1,b=s[y];y>1;)b=se(s[y-1].value,s[y-2],b),y-=2;return b},Ae=function(){var b,u,i;if(he(),b=z(_),ie(b)||b===N)return it();if(b===F||b===R)return Ce();if(b===O)return de();for(u=S.substr(_,L),i=u.length;i>0;){if(M.hasOwnProperty(u)&&(!j(z(_))||_+u.length<S.length&&!k(z(_+u.length))))return _+=i,{type:p,operator:u,argument:Ae(),prefix:!0};u=u.substr(0,--i)}return j(b)||b===B?We():!1},it=function(){for(var b="",u,i;ie(z(_));)b+=X(_++);if(z(_)===N)for(b+=X(_++);ie(z(_));)b+=X(_++);if(u=X(_),u==="e"||u==="E"){for(b+=X(_++),u=X(_),(u==="+"||u==="-")&&(b+=X(_++));ie(z(_));)b+=X(_++);ie(z(_-1))||T("Expected exponent ("+b+X(_)+")",_)}return i=z(_),j(i)?T("Variable names cannot start with a number ("+b+X(_)+")",_):i===N&&T("Unexpected period",_),{type:c,value:parseFloat(b),raw:b}},Ce=function(){for(var b="",u=X(_++),i=!1,s;_<be;)if(s=X(_++),s===u){i=!0;break}else if(s==="\\")switch(s=X(_++),s){case"n":b+=`
`;break;case"r":b+="\r";break;case"t":b+="	";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+="\v";break;default:b+=s}else b+=s;return i||T('Unclosed quote after "'+b+'"',_),{type:c,value:b,raw:u+b+u}},je=function(){var b=z(_),u=_,i;for(j(b)?_++:T("Unexpected "+X(_),_);_<be&&(b=z(_),k(b));)_++;return i=S.slice(u,_),ee.hasOwnProperty(i)?{type:c,value:ee[i],raw:i}:i===q?{type:a}:{type:n,name:i}},qe=function(b){for(var u,i=[],s,f=!1,d=0;_<be;)if(he(),u=z(_),u===b){f=!0,_++,b===v&&d&&d>=i.length&&T("Unexpected token "+String.fromCharCode(b),_);break}else if(u===I){if(_++,d++,d!==i.length){if(b===v)T("Unexpected token ,",_);else if(b===A)for(var m=i.length;m<d;m++)i.push(null)}}else s=_e(),(!s||s.type===r)&&T("Expected comma",_),i.push(s);return f||T("Expected "+String.fromCharCode(b),_),i},We=function(){var b,u;for(b=z(_),b===B?u=Ne():u=je(),he(),b=z(_);b===N||b===O||b===B;)_++,b===N?(he(),u={type:o,computed:!1,object:u,property:je()}):b===O?(u={type:o,computed:!0,object:u,property:_e()},he(),b=z(_),b!==A&&T("Unclosed [",_),_++):b===B&&(u={type:h,arguments:qe(v),callee:u}),he(),b=z(_);return u},Ne=function(){_++;var b=_e();if(he(),z(_)===v)return _++,b;T("Unclosed (",_)},de=function(){return _++,{type:x,elements:qe(A)}},Ie=[],ke,me;_<be;)ke=z(_),ke===$||ke===I?_++:(me=_e())?Ie.push(me):_<be&&T('Unexpected "'+X(_)+'"',_);return Ie.length===1?Ie[0]:{type:r,body:Ie}};G.version="0.3.5",G.toString=function(){return"JavaScript Expression Parser (JSEP) v"+G.version},G.addUnaryOp=function(S){return L=Math.max(S.length,L),M[S]=W,this},G.addBinaryOp=function(S,_){return J=Math.max(S.length,J),C[S]=_,this},G.addLiteral=function(S,_){return ee[S]=_,this},G.removeUnaryOp=function(S){return delete M[S],S.length===L&&(L=P(M)),this},G.removeAllUnaryOps=function(){return M={},L=0,this},G.removeBinaryOp=function(S){return delete C[S],S.length===J&&(J=P(C)),this},G.removeAllBinaryOps=function(){return C={},J=0,this},G.removeLiteral=function(S){return delete ee[S],this},G.removeAllLiterals=function(){return ee={},this},l.exports?e=l.exports=G:e.parse=G})()})(He,He.exports)),He.exports}var Ci=Mi();const Ze=kt(Ci);var le=function(l,e){try{var t,r=l;switch(r.type){case"ArrayExpression":return Promise.resolve(Ot(r.elements,e));case"BinaryExpression":return Promise.resolve(Promise.all([le(r.left,e),le(r.right,e)])).then(function(w){return Me[r.operator](w[0],w[1])});case"CallExpression":var n,o,c,a=function(){if(typeof o=="function"){var w=o,x=w.apply,N=n;return Promise.resolve(Ot(r.arguments,e)).then(function(I){return Promise.resolve(x.call(w,N,I))})}},h=r.callee.type==="MemberExpression"?Promise.resolve(Nt(r.callee,e)).then(function(w){n=(c=w)[0],o=c[1]}):Promise.resolve(le(r.callee,e)).then(function(w){o=w});return Promise.resolve(h&&h.then?h.then(a):a());case"ConditionalExpression":return Promise.resolve(le(r.test,e)).then(function(w){return Promise.resolve(le(w?r.consequent:r.alternate,e))});case"Identifier":return Promise.resolve(e[r.name]);case"Literal":return Promise.resolve(r.value);case"LogicalExpression":var p=function(w){return t?w:Promise.resolve(Promise.all([le(r.left,e),le(r.right,e)])).then(function(x){return Me[r.operator](x[0],x[1])})},g=r.operator==="||"?Promise.resolve(le(r.left,e)).then(function(w){return w?(t=1,w):Promise.resolve(le(r.right,e)).then(function(x){return t=1,x})}):(function(){if(r.operator==="&&")return Promise.resolve(le(r.left,e)).then(function(w){return w?Promise.resolve(le(r.right,e)).then(function(x){return t=1,x}):(t=1,w)})})();return Promise.resolve(g&&g.then?g.then(p):p(g));case"MemberExpression":return Promise.resolve(Nt(r,e)).then(function(w){return w[1]});case"ThisExpression":return Promise.resolve(e);case"UnaryExpression":var E=dt[r.operator];return Promise.resolve(le(r.argument,e)).then(function(w){return E.call(dt,w)});default:return Promise.resolve(void 0)}}catch(w){return Promise.reject(w)}},Nt=function(l,e){try{return Promise.resolve(le(l.object,e)).then(function(t){function r(){if(/^__proto__|prototype|constructor$/.test(n))throw Error('Access to member "'+n+'" disallowed.');return[t,t[n]]}var n,o=(function(){if(l.computed)return Promise.resolve(le(l.property,e)).then(function(c){n=c});n=l.property.name})();return o&&o.then?o.then(r):r()})}catch(t){return Promise.reject(t)}},Ot=function(l,e){try{return Promise.resolve(Promise.all(l.map(function(t){return le(t,e)})))}catch(t){return Promise.reject(t)}},ki={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Me={"||":function(l,e){return l||e},"&&":function(l,e){return l&&e},"|":function(l,e){return l|e},"^":function(l,e){return l^e},"&":function(l,e){return l&e},"==":function(l,e){return l==e},"!=":function(l,e){return l!=e},"===":function(l,e){return l===e},"!==":function(l,e){return l!==e},"<":function(l,e){return l<e},">":function(l,e){return l>e},"<=":function(l,e){return l<=e},">=":function(l,e){return l>=e},"<<":function(l,e){return l<<e},">>":function(l,e){return l>>e},">>>":function(l,e){return l>>>e},"+":function(l,e){return l+e},"-":function(l,e){return l-e},"*":function(l,e){return l*e},"/":function(l,e){return l/e},"%":function(l,e){return l%e}},dt={"-":function(l){return-l},"+":function(l){return+l},"~":function(l){return~l},"!":function(l){return!l}};function Lt(l,e){return l.map(function(t){return fe(t,e)})}function Mt(l,e){var t,r=fe(l.object,e);if(t=l.computed?fe(l.property,e):l.property.name,/^__proto__|prototype|constructor$/.test(t))throw Error('Access to member "'+t+'" disallowed.');return[r,r[t]]}function fe(l,e){var t=l;switch(t.type){case"ArrayExpression":return Lt(t.elements,e);case"BinaryExpression":return Me[t.operator](fe(t.left,e),fe(t.right,e));case"CallExpression":var r,n,o;return t.callee.type==="MemberExpression"?(r=(o=Mt(t.callee,e))[0],n=o[1]):n=fe(t.callee,e),typeof n!="function"?void 0:n.apply(r,Lt(t.arguments,e));case"ConditionalExpression":return fe(t.test,e)?fe(t.consequent,e):fe(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":var c=fe(t.left,e);return t.operator==="||"&&c?c:t.operator!=="&&"||c?Me[t.operator](c,fe(t.right,e)):c;case"MemberExpression":return Mt(t,e)[1];case"ThisExpression":return e;case"UnaryExpression":return dt[t.operator](fe(t.argument,e));default:return}}function Di(l){return fe.bind(null,Ze(l))}function Ti(l){return le.bind(null,Ze(l))}function Ui(l,e,t){t?(Ze.addBinaryOp(l,e),Me[l]=t):(Ze.addBinaryOp(l,ki[l]||1),Me[l]=e)}var oe;(function(l){l[l.Allow=1]="Allow",l[l.Indeterminate=2]="Indeterminate",l[l.Deny=3]="Deny"})(oe||(oe={}));class $i{constructor(e){this.done=!1,this.res=!1,this.rec=!1,this.expr=e}current(){return this.res}pushEffect(e){switch(this.expr){case"some(where (p_eft == allow))":e===oe.Allow&&(this.res=!0,this.done=!0,this.rec=!0);break;case"!some(where (p_eft == deny))":this.res=!0,e===oe.Deny&&(this.res=!1,this.done=!0,this.rec=!0);break;case"some(where (p_eft == allow)) && !some(where (p_eft == deny))":e===oe.Allow?(this.res=!0,this.rec=!0):e===oe.Deny?(this.res=!1,this.done=!0,this.rec=!0):this.rec=!1;break;case"priority(p_eft) || deny":case"subjectPriority(p_eft) || deny":e!==oe.Indeterminate&&(this.res=e===oe.Allow,this.done=!0,this.rec=!0);break;default:throw new Error("unsupported effect")}return[this.res,this.rec,this.done]}}class ji{newStream(e){return new $i(e)}}class qi{constructor(){this.enable=!1}enableLog(e){this.enable=e}isEnable(){return this.enable}print(...e){this.enable&&console.log(...e)}printf(e,...t){this.enable&&console.log(e,...t)}}let Gt=new qi;function Ue(){return Gt}function Re(...l){Gt.print(...l)}const xe="casbin::default";function ye(l,e,t){const r=l.get(e);return r===void 0?(l.set(e,t),t):r}class Le{constructor(e){this.name=e,this.roles=[]}addRole(e){this.roles.some(t=>t.name===e.name)||this.roles.push(e)}deleteRole(e){this.roles=this.roles.filter(t=>t.name!==e.name)}hasRole(e,t){if(this.name===e)return!0;if(t<=0)return!1;for(const r of this.roles)if(r.hasRole(e,t-1))return!0;return!1}hasDirectRole(e){return this.roles.some(t=>t.name===e)}toString(){return this.name+this.roles.join(", ")}getRoles(){return this.roles.map(e=>e.name)}}class Be extends Map{constructor(){super()}hasRole(e,t){let r=!1;if(t)this.forEach((n,o)=>{t(e,o)&&(r=!0)});else return this.has(e);return r}createRole(e,t){const r=ye(this,e,new Le(e));return t&&this.forEach((n,o)=>{if(t(e,o)&&e!==o){const c=ye(this,o,new Le(o));r.addRole(c)}}),r}}class et{constructor(e){this.hasPattern=!1,this.hasDomainPattern=!1,this.hasDomainHierarchy=!1,this.allDomains=new Map,this.allDomains.set(xe,new Be),this.maxHierarchyLevel=e}async addMatchingFunc(e,t){if(this.hasPattern=!0,typeof e=="string"&&t)this.matchingFunc=t;else if(typeof e=="function")this.matchingFunc=e;else throw new Error("error: domain should be 1 parameter")}async addDomainMatchingFunc(e){this.hasDomainPattern=!0,this.domainMatchingFunc=e}async addDomainHierarchy(e){if(!e?.syncedHasLink)throw Error("Domain hierarchy must be syncronous.");this.hasDomainHierarchy=!0,this.domainHierarchyManager=e}generateTempRoles(e){if(!this.hasPattern&&!this.hasDomainPattern&&!this.hasDomainHierarchy)return ye(this.allDomains,e,new Be);const t=new Set([e]);(this.hasDomainPattern||this.hasDomainHierarchy)&&this.allDomains.forEach((n,o)=>{var c;(this.hasDomainPattern&&this.domainMatchingFunc(e,o)||!((c=this.domainHierarchyManager)===null||c===void 0)&&c.syncedHasLink&&this.domainHierarchyManager.syncedHasLink(o,e))&&t.add(o)});const r=new Be;return t.forEach(n=>{ye(this.allDomains,n,new Be).forEach((o,c)=>{const a=r.createRole(o.name,this.matchingFunc);o.getRoles().forEach(h=>{a.addRole(r.createRole(h,this.matchingFunc))})})}),r}async addLink(e,t,...r){if(r.length===0)r=[xe];else if(r.length>1)throw new Error("error: domain should be 1 parameter");const n=ye(this.allDomains,r[0],new Be),o=ye(n,e,new Le(e)),c=ye(n,t,new Le(t));o.addRole(c)}async clear(){this.allDomains=new Map,this.allDomains.set(xe,new Be)}async deleteLink(e,t,...r){if(r.length===0)r=[xe];else if(r.length>1)throw new Error("error: domain should be 1 parameter");const n=ye(this.allDomains,r[0],new Be);if(!n.has(e)||!n.has(t))return;const o=ye(n,e,new Le(e)),c=ye(n,t,new Le(t));o.deleteRole(c)}syncedHasLink(e,t,...r){if(r.length===0)r=[xe];else if(r.length>1)throw new Error("error: domain should be 1 parameter");if(e===t)return!0;const n=this.generateTempRoles(r[0]);return!n.hasRole(e,this.matchingFunc)||!n.hasRole(t,this.matchingFunc)?!1:n.createRole(e,this.matchingFunc).hasRole(t,this.maxHierarchyLevel)}async hasLink(e,t,...r){return new Promise(n=>n(this.syncedHasLink(e,t,...r)))}async getRoles(e,...t){if(t.length===0)t=[xe];else if(t.length>1)throw new Error("error: domain should be 1 parameter");const r=this.generateTempRoles(t[0]);return r.hasRole(e,this.matchingFunc)?r.createRole(e,this.matchingFunc).getRoles():[]}async getUsers(e,...t){if(t.length===0)t=[xe];else if(t.length>1)throw new Error("error: domain should be 1 parameter");const r=this.generateTempRoles(t[0]);if(!r.hasRole(e,this.matchingFunc))return[];const n=[];for(const o of r.values())o.hasDirectRole(e)&&n.push(o.name);return n}async printRoles(){Ue().isEnable()&&[...this.allDomains.values()].forEach(e=>{Re(e.toString())})}async getDomains(e){const t=[];return this.allDomains.forEach((r,n)=>{if(n===xe&&this.allDomains.size>1)return;const o=r.get(e);if(o){const c=o.getRoles().length>0,a=this.hasUserForRole(r,e);(c||a)&&t.push(n)}}),t}async getAllDomains(){const e=Array.from(this.allDomains.keys());return e.length>1?e.filter(t=>t!==xe):e}hasUserForRole(e,t){for(const r of e.values())if(r.hasDirectRole(t))return!0;return!1}}const ct="",Wi="::",ut={r:"request_definition",p:"policy_definition",g:"role_definition",e:"policy_effect",m:"matchers"};var te;(function(l){l[l.PolicyAdd=0]="PolicyAdd",l[l.PolicyRemove=1]="PolicyRemove"})(te||(te={}));const Gi=["r","p","e","m"];class Vt{constructor(){this.model=new Map}loadAssertion(e,t,r){const n=ut[t],o=e.getString(`${n}::${r}`);return this.addDef(t,r,o)}getKeySuffix(e){return e===1?"":e.toString()}loadSection(e,t){let r=1;for(;this.loadAssertion(e,t,t+this.getKeySuffix(r));)r++}addDef(e,t,r){if(r==="")return!1;const n=new Vi;if(n.key=t,n.value=r,n.fieldIndexMap=new Map,e==="r"||e==="p"){const c=r.split(",").map(a=>a.trim());for(let a=0;a<c.length;a++)c[a]=t+"_"+c[a];n.tokens=c}else if(e==="m"){const c=r.match(/\"(.*?)\"/g)||[];if(c.forEach((h,p)=>{r=r.replace(h,`$<${p}>`)}),r=Xe(r),c.forEach((h,p)=>{r=r.replace(`$<${p}>`,h)}),/(?<![&|])&(?!&)|(?<![&|])\|(?!\|)|&{3,}|\|{3,}/g.test(r))throw new Error("Invalid operator in matcher");n.value=r}else n.value=Xe(r);const o=this.model.get(e);if(o)o.set(t,n);else{const c=new Map;c.set(t,n),this.model.set(e,c)}return!0}loadModel(e,t){this.loadModelFromFile(e,t)}loadModelFromFile(e,t){const r=ue.newConfigFromFile(e,t);this.loadModelFromConfig(r)}loadModelFromText(e){const t=ue.newConfigFromText(e);this.loadModelFromConfig(t)}loadModelFromConfig(e){for(const r in ut)this.loadSection(e,r);const t=[];if(Gi.forEach(r=>{this.hasSection(r)||t.push(ut[r])}),t.length>0)throw new Error(`missing required sections: ${t.join(",")}`)}hasSection(e){return this.model.get(e)!==void 0}printModel(){Re("Model:"),this.model.forEach((e,t)=>{e.forEach((r,n)=>{Re(`${t}.${n}: ${r.value}`)})})}async buildIncrementalRoleLinks(e,t,r,n,o){var c,a;r==="g"&&await((a=(c=this.model.get(r))===null||c===void 0?void 0:c.get(n))===null||a===void 0?void 0:a.buildIncrementalRoleLinks(e,t,o))}async buildRoleLinks(e){const t=this.model.get("g");if(t)for(const r of t.keys()){const n=t.get(r);let o=e.get(r);o||(o=new et(10),e.set(r,o)),await n?.buildRoleLinks(o)}}clearPolicy(){this.model.forEach((e,t)=>{(t==="p"||t==="g")&&e.forEach(r=>{r.policy=[]})})}getPolicy(e,t){var r;const n=[],o=(r=this.model.get(e))===null||r===void 0?void 0:r.get(t);return o&&n.push(...o.policy),n}hasPolicy(e,t,r){var n;const o=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);return o?o.policy.some(c=>Je(c,r)):!1}addPolicy(e,t,r){var n;if(!this.hasPolicy(e,t,r)){const o=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);if(!o)return!1;const c=o.policy,h=o.tokens.indexOf(`${t}_priority`);if(h!==-1){const p=r[h],g=c.findIndex(E=>E[h]>=p);h===-1?c.push(r):c.splice(g,0,r)}else c.push(r);return!0}return!1}addPolicies(e,t,r){var n;const o=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);if(!o)return[!1,[]];for(const a of r)if(this.hasPolicy(e,t,a))return[!1,[]];return o.tokens.indexOf(`${t}_priority`)!==-1?r.forEach(a=>{this.addPolicy(e,t,a)}):o.policy=o.policy.concat(r),[!0,r]}updatePolicy(e,t,r,n){var o;const c=(o=this.model.get(e))===null||o===void 0?void 0:o.get(t);if(!c)return!1;const a=c.policy.findIndex(p=>Je(p,r));if(a===-1)return!1;const h=c.tokens.indexOf(`${t}_priority`);if(h!==-1)if(r[h]===n[h])c.policy[a]=n;else throw new Error("new rule should have the same priority with old rule.");else c.policy[a]=n;return!0}removePolicy(e,t,r){var n;if(this.hasPolicy(e,t,r)){const o=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);return o?(o.policy=o.policy.filter(c=>!Je(r,c)),!0):!1}return!1}removePolicies(e,t,r){var n;const o=[],c=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);if(!c)return[!1,[]];for(const a of r)if(!this.hasPolicy(e,t,a))return[!1,[]];for(const a of r)c.policy=c.policy.filter(h=>{const p=Je(a,h);return p&&o.push(h),!p});return[!0,o]}getFilteredPolicy(e,t,r,...n){var o;const c=[],a=(o=this.model.get(e))===null||o===void 0?void 0:o.get(t);if(!a)return c;for(const h of a.policy){let p=!0;for(let g=0;g<n.length;g++){const E=n[g];if(E!==""&&h[r+g]!==E){p=!1;break}}p&&c.push(h)}return c}removeFilteredPolicy(e,t,r,...n){var o;const c=[],a=[];let h=!1;if(n.length===0)return[!1,a];const p=(o=this.model.get(e))===null||o===void 0?void 0:o.get(t);if(!p)return[!1,[]];for(const g of p.policy){let E=!0;for(let w=0;w<n.length;w++){const x=n[w];if(x!==""&&g[r+w]!==x){E=!1;break}}E?(h=!0,a.push(g)):c.push(g)}return a.length!==0&&(p.policy=c),[h,a]}getValuesForFieldInPolicy(e,t,r){var n;const o=[],c=(n=this.model.get(e))===null||n===void 0?void 0:n.get(t);return c?Ke(c.policy.map(a=>a[r])):o}getValuesForFieldInPolicyAllTypes(e,t){const r=[],n=this.model.get(e);if(!n)return r;for(const o of n.keys())r.push(...this.getValuesForFieldInPolicy(e,o,t));return Ke(r)}printPolicy(){Ue().isEnable()&&(Re("Policy:"),this.model.forEach((e,t)=>{(t==="p"||t==="g")&&e.forEach(r=>{Re(`key, : ${r.value}, : , ${r.policy}`)})}))}getFieldIndex(e,t){var r;const n=(r=this.model.get("p"))===null||r===void 0?void 0:r.get(e);if(!n)return-1;let o=n.fieldIndexMap.get(t);if(o)return o;const c=e+"_"+t;o=-1;for(let a=0;a<n.tokens.length;a++)if(n.tokens[a]===c){o=a;break}return o===-1||n.fieldIndexMap.set(t,o),o}sortPoliciesBySubjectHierarchy(){var e,t,r;((t=(e=this.model.get("e"))===null||e===void 0?void 0:e.get("e"))===null||t===void 0?void 0:t.value)==="subjectPriority(p_eft) || deny"&&((r=this.model.get("p"))===null||r===void 0||r.forEach((n,o)=>{const c=this.getFieldIndex(o,"dom"),a=this.getFieldIndex(o,"sub"),h=this.getSubjectHierarchyMap(this.model.get("g").get("g").policy);n.policy.sort((p,g)=>{const E=c===-1?ct:p[c],w=c===-1?ct:g[c],x=h.get(this.getNameWithDomain(E,p[a]));return h.get(this.getNameWithDomain(w,g[a]))-x})}))}getSubjectHierarchyMap(e){const t=new Map;if(!e)return t;const r=new Map;let n=ct;e.forEach(c=>{c.length!==2&&(n=c[this.getFieldIndex("p","dom")]);const a=this.getNameWithDomain(n,c[this.getFieldIndex("p","sub")]),h=this.getNameWithDomain(n,c[this.getFieldIndex("p","obj")]);r.set(a,h),t.has(a)||t.set(a,0),t.has(h)||t.set(h,0),t.set(a,1)});const o=new Set;for(t.forEach((c,a)=>{t.get(a)!==0&&o.add(a)});o.size!==0;)for(const c of o.values())this.findHierarchy(r,t,o,c);return t}findHierarchy(e,t,r,n){r.delete(n);const o=e.get(n);r.has(o)&&this.findHierarchy(e,t,r,o),t.set(n,t.get(o)+10)}getNameWithDomain(e,t){return e+Wi+t}}function tn(...l){const e=new Vt;if(l.length===2)l[0]!==""&&e.loadModelFromFile(l[0]);else if(l.length===1)e.loadModelFromText(l[0]);else if(l.length!==0)throw new Error("Invalid parameters for model.");return e}function Jt(l,e){const t=new Vt;return l&&t.loadModelFromFile(l,e),t}class Vi{constructor(){this.key="",this.value="",this.tokens=[],this.policy=[],this.rm=new et(10),this.fieldIndexMap=new Map}async buildIncrementalRoleLinks(e,t,r){this.rm=e;const n=(this.value.match(/_/g)||[]).length;if(n<2)throw new Error('the number of "_" in role definition should be at least 2');for(let o of r){if(o.length<n)throw new Error("grouping policy elements do not meet role definition");switch(o.length>n&&(o=o.slice(0,n)),t){case te.PolicyAdd:await this.rm.addLink(o[0],o[1],...o.slice(2));break;case te.PolicyRemove:await this.rm.deleteLink(o[0],o[1],...o.slice(2));break;default:throw new Error("unsupported operation")}}}async buildRoleLinks(e){this.rm=e;const t=(this.value.match(/_/g)||[]).length;if(t<2)throw new Error('the number of "_" in role definition should be at least 2');for(let r of this.policy)r.length>t&&(r=r.slice(0,t)),await this.rm.addLink(r[0],r[1],...r.slice(2));Re(`Role links for: ${this.key}`),await this.rm.printRoles()}}class pt{constructor(){this.functions=new Map}static loadFunctionMap(){const e=new pt;return e.addFunction("keyMatch",Tr),e.addFunction("keyGet",$r),e.addFunction("keyMatch2",jr),e.addFunction("keyGet2",Wr),e.addFunction("keyMatch3",Vr),e.addFunction("keyMatch4",zr),e.addFunction("keyMatch5",Qr),e.addFunction("regexMatch",Yr),e.addFunction("ipMatch",Kr),e.addFunction("globMatch",Zr),e}addFunction(e,t){this.functions.get(e)||this.functions.set(e,t)}getFunctions(){return this.functions}}class Pe{constructor(e,t,r,n){this.pType=t,this.eType=r,this.mType=n,this.rType=e}}class Ji{constructor(){this.fm=pt.loadFunctionMap(),this.eft=new ji,this.matcherMap=new Map,this.defaultEnforceContext=new Pe("r","p","e","m"),this.watcher=null,this.watcherEx=null,this.enabled=!0,this.autoSave=!0,this.autoBuildRoleLinks=!0,this.autoNotifyWatcher=!0,this.acceptJsonRequest=!1}setFileSystem(e){this.fs=e}getFileSystem(){return this.fs}getExpression(e,t){const r=`${e?"ASYNC[":"SYNC["}${t}]`;Ui("in",1,Ri);let n=this.matcherMap.get(r);return n||(t=Ai(t),n=e?Ti(t):Di(t),this.matcherMap.set(r,n)),n}loadModel(){this.model=Jt(this.modelPath,this.fs),this.model.printModel()}getModel(){return this.model}setModel(e){this.model=e}getAdapter(){return this.adapter}setAdapter(e){this.adapter=e}setWatcher(e){this.watcher=e,e.setUpdateCallback(async()=>await this.loadPolicy())}setWatcherEx(e){this.watcherEx=e}setRoleManager(e){this.rmMap.set("g",e)}setNamedRoleManager(e,t){this.rmMap.set(e,t)}getRoleManager(){return this.rmMap.get("g")}getNamedRoleManager(e){return this.rmMap.get(e)}setEffector(e){this.eft=e}clearPolicy(){this.model.clearPolicy()}initRmMap(){this.rmMap=new Map;const e=this.model.model.get("g");if(e)for(const t of e.keys())this.rmMap.set(t,new et(10))}sortPolicies(){var e;(e=this.model.model.get("p"))===null||e===void 0||e.forEach((t,r)=>{const n=t.policy,o=t.tokens;if(n&&o){const c=o.indexOf(`${r}_priority`);c!==-1&&n.sort((a,h)=>parseInt(a[c],10)-parseInt(h[c],10))}})}async loadPolicy(){this.model.clearPolicy(),await this.adapter.loadPolicy(this.model),this.sortPolicies(),this.model.sortPoliciesBySubjectHierarchy(),this.autoBuildRoleLinks&&await this.buildRoleLinksInternal()}async loadFilteredPolicy(e){return this.model.clearPolicy(),this.sortPolicies(),this.model.sortPoliciesBySubjectHierarchy(),this.loadIncrementalFilteredPolicy(e)}async loadIncrementalFilteredPolicy(e){if("isFiltered"in this.adapter)await this.adapter.loadFilteredPolicy(this.model,e);else throw new Error("filtered policies are not supported by this adapter");return this.sortPolicies(),this.autoBuildRoleLinks&&await this.buildRoleLinksInternal(),!0}isFiltered(){return"isFiltered"in this.adapter?this.adapter.isFiltered():!1}async savePolicy(){if(this.isFiltered())throw new Error("Cannot save a filtered policy");return await this.adapter.savePolicy(this.model)?this.watcherEx?await this.watcherEx.updateForSavePolicy(this.model):this.watcher?await this.watcher.update():!0:!1}enableEnforce(e){this.enabled=e}enableLog(e){Ue().enableLog(e)}enableAutoSave(e){this.autoSave=e}enableAutoNotifyWatcher(e){this.autoNotifyWatcher=e}enableAcceptJsonRequest(e){this.acceptJsonRequest=e}enableAutoBuildRoleLinks(e){this.autoBuildRoleLinks=e}async addNamedMatchingFunc(e,t){const r=this.rmMap.get(e);if(r)return await r.addMatchingFunc(t);throw Error("Target ptype not found.")}async addNamedDomainMatchingFunc(e,t){const r=this.rmMap.get(e);if(r)return await r.addDomainMatchingFunc(t)}async buildRoleLinks(){return this.buildRoleLinksInternal()}async buildIncrementalRoleLinks(e,t,r){let n=this.rmMap.get(t);n||(n=new et(10),this.rmMap.set(t,n)),await this.model.buildIncrementalRoleLinks(n,e,"g",t,r)}async buildRoleLinksInternal(){for(const e of this.rmMap.values())await e.clear(),await this.model.buildRoleLinks(this.rmMap)}*privateEnforce(e=!0,t=!1,r,n=new Pe("r","p","e","m"),...o){var c,a,h,p,g,E,w,x,N,I;if(!this.enabled)return!0;let F=-1;const R={};this.fm.getFunctions().forEach((P,L)=>{R[L]=P});const B=this.model.model.get("g");B?.forEach((P,L)=>{const J=P.rm;R[L]=e?ei(J):ti(J)});let v;if(r?v=Ii(Xe(r)):v=(a=(c=this.model.model.get("m"))===null||c===void 0?void 0:c.get(n.mType))===null||a===void 0?void 0:a.value,!v)throw new Error("Unable to find matchers in model");const O=(p=(h=this.model.model.get("e"))===null||h===void 0?void 0:h.get(n.eType))===null||p===void 0?void 0:p.value;if(!O)throw new Error("Unable to find policy_effect in model");const A=Fi(v);let D;const $=(g=this.model.model.get("p"))===null||g===void 0?void 0:g.get(n.pType),H=(E=$?.policy)===null||E===void 0?void 0:E.length,T=(x=(w=this.model.model.get("r"))===null||w===void 0?void 0:w.get(n.rType))===null||x===void 0?void 0:x.tokens,W=T?.length,M=this.eft.newStream(O);if(H&&H!==0&&v.includes(`${n.pType}_`))for(let P=0;P<H;P++){const L={};if(T?.length!==o.length)throw new Error(`invalid request size: expected ${W}, got ${o.length}, rvals: ${o}"`);if(this.acceptJsonRequest?T.forEach((k,G)=>{try{L[k]=JSON.parse(o[G])}catch{L[k]=o[G]}}):T.forEach((k,G)=>{L[k]=o[G]}),$?.tokens.forEach((k,G)=>{L[k]=$?.policy[P][G]}),A){const k=Bi(v);let G=v;for(const S of k)if(S in L){const _=Xe(L[S]);G=Si(G,S,_)}else throw new Error(`${S} not in ${L}`);D=this.getExpression(e,G)}else D===void 0&&(D=this.getExpression(e,v));const J=Object.assign(Object.assign({},L),R),ee=e?yield D(J):D(J);let q;switch(typeof ee){case"boolean":q=ee?oe.Allow:oe.Indeterminate;break;case"number":ee===0?q=oe.Indeterminate:q=ee;break;case"string":ee===""?q=oe.Indeterminate:q=oe.Allow;break;default:throw new Error("matcher result should only be of type boolean, number, or string")}const re=L[`${n.pType}_eft`];re&&q===oe.Allow&&(re==="allow"?q=oe.Allow:re==="deny"?q=oe.Deny:q=oe.Indeterminate);const[se,ie,j]=M.pushEffect(q);if(ie&&(F=P),j)break}else{F=0;const P={};T?.forEach((ee,q)=>{P[ee]=o[q]}),(N=$?.tokens)===null||N===void 0||N.forEach(ee=>{P[ee]=""}),D=this.getExpression(e,v);const L=Object.assign(Object.assign({},P),R);(e?yield D(L):D(L))?M.pushEffect(oe.Allow):M.pushEffect(oe.Indeterminate)}const C=M.current();if(Ue().isEnable()){let P="Request: ";for(let L=0;L<o.length;L++)L!==o.length-1?P+=`${o[L]}, `:P+=o[L];P+=` ---> ${C}`,Re(P)}return t?F===-1?[C,[]]:[C,((I=$?.policy)===null||I===void 0?void 0:I[F])||[]]:C}enforceSync(...e){if(e[0]instanceof Pe){const t=e.shift();return ze(this.privateEnforce(!1,!1,"",t,...e))}return ze(this.privateEnforce(!1,!1,"",this.defaultEnforceContext,...e))}enforceExSync(...e){if(e[0]instanceof Pe){const t=e.shift();return ze(this.privateEnforce(!1,!0,"",t,...e))}return ze(this.privateEnforce(!1,!0,"",this.defaultEnforceContext,...e))}enforceWithSyncCompile(...e){return this.enforceSync(...e)}async enforce(...e){if(e[0]instanceof Pe){const t=e.shift();return ve(this.privateEnforce(!0,!1,"",t,...e))}return ve(this.privateEnforce(!0,!1,"",this.defaultEnforceContext,...e))}async enforceWithMatcher(e,...t){if(t[0]instanceof Pe){const r=t.shift();return ve(this.privateEnforce(!0,!1,e,r,...t))}return ve(this.privateEnforce(!0,!1,e,this.defaultEnforceContext,...t))}async enforceEx(...e){if(e[0]instanceof Pe){const t=e.shift();return ve(this.privateEnforce(!0,!0,"",t,...e))}return ve(this.privateEnforce(!0,!0,"",this.defaultEnforceContext,...e))}async enforceExWithMatcher(e,...t){if(t[0]instanceof Pe){const r=t.shift();return ve(this.privateEnforce(!0,!0,e,r,...t))}return ve(this.privateEnforce(!0,!0,e,this.defaultEnforceContext,...t))}async batchEnforce(e){return await Promise.all(e.map(t=>this.enforce(...t)))}}class zi extends Ji{async addPolicyInternal(e,t,r,n){if(this.model.hasPolicy(e,t,r))return!1;if(this.adapter&&this.autoSave)try{await this.adapter.addPolicy(e,t,r)}catch(c){if(c.message!=="not implemented")throw c}n&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForAddPolicy(e,t,...r):this.watcher&&this.watcher.update());const o=this.model.addPolicy(e,t,r);return e==="g"&&o&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,[r]),o}async addPoliciesInternal(e,t,r,n){for(const a of r)if(this.model.hasPolicy(e,t,a))return!1;if(this.adapter&&this.autoSave)if("addPolicies"in this.adapter)try{await this.adapter.addPolicies(e,t,r)}catch(a){if(a.message!=="not implemented")throw a}else throw new Error("cannot to save policy, the adapter does not implement the BatchAdapter");n&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForAddPolicies(e,t,...r):this.watcher&&this.watcher.update());const[o,c]=await this.model.addPolicies(e,t,r);return e==="g"&&o&&c?.length&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,c),o}async addPoliciesInternalEx(e,t,r,n){const o=r.filter(h=>!this.model.hasPolicy(e,t,h));if(o.length===0)return!1;if(this.adapter&&this.autoSave)if("addPolicies"in this.adapter)try{await this.adapter.addPolicies(e,t,o)}catch(h){if(h.message!=="not implemented")throw h}else throw new Error("cannot save policy, the adapter does not implement the BatchAdapter");n&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForAddPolicies(e,t,...o):this.watcher&&this.watcher.update());const[c,a]=await this.model.addPolicies(e,t,o);return e==="g"&&c&&a?.length&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,a),c}async updatePolicyInternal(e,t,r,n,o){if(!this.model.hasPolicy(e,t,r))return!1;if(this.adapter&&this.autoSave)if("updatePolicy"in this.adapter)try{await this.adapter.updatePolicy(e,t,r,n)}catch(a){if(a.message!=="not implemented")throw a}else throw new Error("cannot to update policy, the adapter does not implement the UpdatableAdapter");o&&this.autoNotifyWatcher&&this.watcher&&this.watcher.update();const c=this.model.updatePolicy(e,t,r,n);return e==="g"&&c&&(await this.buildIncrementalRoleLinks(te.PolicyRemove,t,[r]),await this.buildIncrementalRoleLinks(te.PolicyAdd,t,[n])),c}async removePolicyInternal(e,t,r,n){if(!this.model.hasPolicy(e,t,r))return!1;if(this.adapter&&this.autoSave)try{await this.adapter.removePolicy(e,t,r)}catch(c){if(c.message!=="not implemented")throw c}n&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForRemovePolicy(e,t,...r):this.watcher&&this.watcher.update());const o=await this.model.removePolicy(e,t,r);return e==="g"&&o&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,[r]),o}async removePoliciesInternal(e,t,r,n){for(const a of r)if(!this.model.hasPolicy(e,t,a))return!1;if(this.adapter&&this.autoSave)if("removePolicies"in this.adapter)try{await this.adapter.removePolicies(e,t,r)}catch(a){if(a.message!=="not implemented")throw a}else throw new Error("cannot to save policy, the adapter does not implement the BatchAdapter");n&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForRemovePolicies(e,t,...r):this.watcher&&this.watcher.update());const[o,c]=this.model.removePolicies(e,t,r);return e==="g"&&o&&c?.length&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,c),o}async removeFilteredPolicyInternal(e,t,r,n,o){if(this.adapter&&this.autoSave)try{await this.adapter.removeFilteredPolicy(e,t,r,...n)}catch(h){if(h.message!=="not implemented")throw h}o&&this.autoNotifyWatcher&&(this.watcherEx?this.watcherEx.updateForRemoveFilteredPolicy(e,t,r,...n):this.watcher&&this.watcher.update());const[c,a]=this.model.removeFilteredPolicy(e,t,r,...n);return e==="g"&&c&&a?.length&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,a),c}getFieldIndex(e,t){return this.model.getFieldIndex(e,t)}setFieldIndex(e,t,r){var n;const o=(n=this.model.model.get("p"))===null||n===void 0?void 0:n.get(e);o?.fieldIndexMap.set(t,r)}async addPolicyWithoutNotify(e,t,r){if(this.model.hasPolicy(e,t,r))return!1;const n=this.model.addPolicy(e,t,r);return e==="g"&&n&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,[r]),n}async addPoliciesWithoutNotify(e,t,r){for(const c of r)if(this.model.hasPolicy(e,t,c))return!1;const[n,o]=await this.model.addPolicies(e,t,r);return e==="g"&&n&&o?.length&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,o),n}async addPoliciesWithoutNotifyEx(e,t,r){const n=r.filter(a=>!this.model.hasPolicy(e,t,a));if(n.length===0)return!1;const[o,c]=await this.model.addPolicies(e,t,n);return e==="g"&&o&&c?.length&&await this.buildIncrementalRoleLinks(te.PolicyAdd,t,c),o}async updatePolicyWithoutNotify(e,t,r,n){if(!this.model.hasPolicy(e,t,r))return!1;const o=this.model.updatePolicy(e,t,r,n);return e==="g"&&o&&(await this.buildIncrementalRoleLinks(te.PolicyRemove,t,[r]),await this.buildIncrementalRoleLinks(te.PolicyAdd,t,[n])),o}async removePolicyWithoutNotify(e,t,r){if(!this.model.hasPolicy(e,t,r))return!1;const n=await this.model.removePolicy(e,t,r);return e==="g"&&n&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,[r]),n}async removePoliciesWithoutNotify(e,t,r){for(const c of r)if(!this.model.hasPolicy(e,t,c))return!1;const[n,o]=this.model.removePolicies(e,t,r);return e==="g"&&n&&o?.length&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,o),n}async removeFilteredPolicyWithoutNotify(e,t,r,n){const[o,c]=this.model.removeFilteredPolicy(e,t,r,...n);return e==="g"&&o&&c?.length&&await this.buildIncrementalRoleLinks(te.PolicyRemove,t,c),o}async updatePoliciesWithoutNotify(e,t,r,n){if(r.length!==n.length)throw new Error("the length of oldRules should be equal to the length of newRules");for(let o=0;o<r.length;o++)if(!await this.updatePolicyWithoutNotify(e,t,r[o],n[o]))return!1;return!0}}class Hi extends zi{async getAllSubjects(){return this.getAllNamedSubjects("p")}async getAllNamedSubjects(e){return this.model.getValuesForFieldInPolicy("p",e,0)}async getAllObjects(){return this.getAllNamedObjects("p")}async getAllNamedObjects(e){return this.model.getValuesForFieldInPolicy("p",e,1)}async getAllActions(){return this.getAllNamedActions("p")}async getAllNamedActions(e){return this.model.getValuesForFieldInPolicy("p",e,2)}async getAllRoles(){return this.getAllNamedRoles("g")}async getAllNamedRoles(e){return this.model.getValuesForFieldInPolicy("g",e,1)}async getPolicy(){return this.getNamedPolicy("p")}async getFilteredPolicy(e,...t){return this.getFilteredNamedPolicy("p",e,...t)}async getNamedPolicy(e){return this.model.getPolicy("p",e)}async getFilteredNamedPolicy(e,t,...r){return this.model.getFilteredPolicy("p",e,t,...r)}async getGroupingPolicy(){return this.getNamedGroupingPolicy("g")}async getFilteredGroupingPolicy(e,...t){return this.getFilteredNamedGroupingPolicy("g",e,...t)}async getNamedGroupingPolicy(e){return this.model.getPolicy("g",e)}async getFilteredNamedGroupingPolicy(e,t,...r){return this.model.getFilteredPolicy("g",e,t,...r)}async hasPolicy(...e){return this.hasNamedPolicy("p",...e)}async hasNamedPolicy(e,...t){return this.model.hasPolicy("p",e,t)}async addPolicy(...e){return this.addNamedPolicy("p",...e)}async addPolicies(e){return this.addNamedPolicies("p",e)}async addNamedPolicy(e,...t){return this.addPolicyInternal("p",e,t,!0)}async addNamedPolicies(e,t){return this.addPoliciesInternal("p",e,t,!0)}async addPoliciesEx(e){return this.addNamedPoliciesEx("p",e)}async addNamedPoliciesEx(e,t){return this.addPoliciesInternalEx("p",e,t,!0)}async updatePolicy(e,t){return this.updateNamedPolicy("p",e,t)}async updateNamedPolicy(e,t,r){return this.updatePolicyInternal("p",e,t,r,!0)}async removePolicy(...e){return this.removeNamedPolicy("p",...e)}async removePolicies(e){return this.removeNamedPolicies("p",e)}async removeFilteredPolicy(e,...t){return this.removeFilteredNamedPolicy("p",e,...t)}async removeNamedPolicy(e,...t){return this.removePolicyInternal("p",e,t,!0)}async removeNamedPolicies(e,t){return this.removePoliciesInternal("p",e,t,!0)}async removeFilteredNamedPolicy(e,t,...r){return this.removeFilteredPolicyInternal("p",e,t,r,!0)}async hasGroupingPolicy(...e){return this.hasNamedGroupingPolicy("g",...e)}async hasNamedGroupingPolicy(e,...t){return this.model.hasPolicy("g",e,t)}async addGroupingPolicy(...e){return this.addNamedGroupingPolicy("g",...e)}async addGroupingPolicies(e){return this.addNamedGroupingPolicies("g",e)}async addNamedGroupingPolicy(e,...t){return this.addPolicyInternal("g",e,t,!0)}async addNamedGroupingPolicies(e,t){return this.addPoliciesInternal("g",e,t,!0)}async addGroupingPoliciesEx(e){return this.addNamedGroupingPoliciesEx("g",e)}async addNamedGroupingPoliciesEx(e,t){return this.addPoliciesInternalEx("g",e,t,!0)}async removeGroupingPolicy(...e){return this.removeNamedGroupingPolicy("g",...e)}async removeGroupingPolicies(e){return this.removeNamedGroupingPolicies("g",e)}async removeFilteredGroupingPolicy(e,...t){return this.removeFilteredNamedGroupingPolicy("g",e,...t)}async removeNamedGroupingPolicy(e,...t){return this.removePolicyInternal("g",e,t,!0)}async removeNamedGroupingPolicies(e,t){return this.removePoliciesInternal("g",e,t,!0)}async removeFilteredNamedGroupingPolicy(e,t,...r){return this.removeFilteredPolicyInternal("g",e,t,r,!0)}async updateGroupingPolicy(e,t){return this.updateNamedGroupingPolicy("g",e,t)}async updateNamedGroupingPolicy(e,t,r){return this.updatePolicyInternal("g",e,t,r,!0)}async addFunction(e,t){this.fm.addFunction(e,t)}async selfAddPolicy(e,t,r){return this.addPolicyWithoutNotify(e,t,r)}async selfAddPolicies(e,t,r){return this.addPoliciesWithoutNotify(e,t,r)}async selfRemovePolicy(e,t,r){return this.removePolicyWithoutNotify(e,t,r)}async selfRemovePolicies(e,t,r){return this.removePoliciesWithoutNotify(e,t,r)}async selfRemoveFilteredPolicy(e,t,r,...n){return this.removeFilteredPolicyWithoutNotify(e,t,r,n)}async selfUpdatePolicy(e,t,r,n){return this.updatePolicyWithoutNotify(e,t,r,n)}async selfUpdatePolicies(e,t,r,n){return this.updatePoliciesWithoutNotify(e,t,r,n)}}class Qi extends Hi{async initWithFile(e,t,r=!1){const n=new Ei(t,this.fs);await this.initWithAdapter(e,n,r)}async initWithString(e,t,r=!1){const n=new xi(t);await this.initWithAdapter(e,n,r)}async initWithAdapter(e,t,r=!1){const n=Jt(e,this.fs);await this.initWithModelAndAdapter(n,t,r),this.modelPath=e}async initWithModelAndAdapter(e,t,r=!1){t&&(this.adapter=t),this.model=e,this.model.printModel(),this.initRmMap(),!r&&this.adapter&&await this.loadPolicy()}async getRolesForUser(e,t){const r=this.rmMap.get("g");if(r)return t===void 0?r.getRoles(e):r.getRoles(e,t);throw new Error("RoleManager didn't exist.")}async getUsersForRole(e,t){const r=this.rmMap.get("g");if(r)return t===void 0?r.getUsers(e):r.getUsers(e,t);throw new Error("RoleManager didn't exist.")}async hasRoleForUser(e,t,r){const n=await this.getRolesForUser(e,r);let o=!1;for(const c of n)if(c===t){o=!0;break}return o}async addRoleForUser(e,t,r){return r===void 0?this.addGroupingPolicy(e,t):this.addGroupingPolicy(e,t,r)}async deleteRoleForUser(e,t,r){if(!e)throw new Error("user must not be empty");if(!t)throw new Error("role must not be empty");return r===void 0?this.removeGroupingPolicy(e,t):this.removeGroupingPolicy(e,t,r)}async deleteRolesForUser(e,t){if(!e)throw new Error("user must not be empty");if(t===void 0){const r=this.getFieldIndex("p","sub");return this.removeFilteredGroupingPolicy(r,e)}else return this.removeFilteredGroupingPolicy(0,e,"",t)}async deleteUser(e){if(!e)throw new Error("user must not be empty");const t=this.getFieldIndex("p","sub"),r=await this.removeFilteredGroupingPolicy(t,e),n=await this.removeFilteredPolicy(t,e);return r||n}async deleteRole(e){if(!e)throw new Error("role must not be empty");const t=this.getFieldIndex("p","sub"),r=await this.removeFilteredGroupingPolicy(t,e),n=await this.removeFilteredPolicy(t,e);return r||n}async deletePermission(...e){if(e.length===0)throw new Error("permission must not be empty");return this.removeFilteredPolicy(1,...e)}async addPermissionForUser(e,...t){return t.unshift(e),this.addPolicy(...t)}async deletePermissionForUser(e,...t){if(!e)throw new Error("user must not be empty");return t.unshift(e),this.removePolicy(...t)}async deletePermissionsForUser(e){if(!e)throw new Error("user must not be empty");const t=this.getFieldIndex("p","sub");return this.removeFilteredPolicy(t,e)}async getPermissionsForUser(e){const t=this.getFieldIndex("p","sub");return this.getFilteredPolicy(t,e)}async hasPermissionForUser(e,...t){return t.unshift(e),this.hasPolicy(...t)}async getImplicitRolesForUser(e,...t){const r=new Set,n=[e];let o;for(;(o=n.shift())!==void 0;)for(const c of this.rmMap.values())(await c.getRoles(o,...t)).forEach(h=>{r.has(h)||(r.add(h),n.push(h))});return Array.from(r)}async getImplicitPermissionsForUser(e,...t){const r=await this.getImplicitRolesForUser(e,...t);r.unshift(e);const n=[],o=t&&t.length!==0;for(const c of r)if(o){const a=await this.getFilteredPolicy(0,c,...t);n.push(...a)}else{const a=await this.getPermissionsForUser(c);n.push(...a)}return n}async getImplicitResourcesForUser(e,...t){const r=await this.getImplicitPermissionsForUser(e,...t),n=[];for(const o of r){if(o[0]===e){n.push(o);continue}let c=[[e]];const a=o.length,h=[];for(const p of o){if(p===o[0])continue;const g=await this.getImplicitUsersForRole(p,...t);g.push(p),h.push(g)}for(let p=0;p<a-1;p++){const g=[];for(const E of h[p])for(const w of c){const x=[...w];x.push(E),g.push(x)}c=g}n.push(...c)}return n}async getImplicitUsersForRole(e,...t){const r=new Set,n=[e];let o;for(;(o=n.shift())!==void 0;)for(const c of this.rmMap.values())(await c.getUsers(o,...t)).forEach(h=>{r.has(h)||(r.add(h),n.push(h))});return Array.from(r)}async getRolesForUserInDomain(e,t){return this.getRolesForUser(e,t)}async getUsersForRoleInDomain(e,t){return this.getUsersForRole(e,t)}async getImplicitUsersForPermission(...e){const t=[],r=await this.getAllSubjects(),n=Ke([...r,...this.model.getValuesForFieldInPolicyAllTypes("g",0)]),o=this.model.getValuesForFieldInPolicyAllTypes("g",1);for(const c of n)await this.enforce(c,...e)&&t.push(c);return t.filter(c=>!o.some(a=>c===a))}async getDomainsForUser(e){const t=[];for(const r of this.rmMap.values()){const n=await r.getDomains(e);t.push(...n)}return t}async getAllDomains(){const e=[];for(const t of this.rmMap.values()){const r=await t.getAllDomains();e.push(...r)}return Ke(e)}}async function Yi(l,...e){var t;if(!_i())try{if(typeof process<"u"&&(!((t=process==null?void 0:process.versions)===null||t===void 0)&&t.node)){const o=await Li(()=>import("./refine-core-C76UMzuX.js").then(a=>a._),__vite__mapDeps([0,1,2,3]));wi({readFileSync(a,h){return o.readFileSync(a,{encoding:h})},writeFileSync(a,h,p){return o.writeFileSync(a,h,p)}})}}catch{}const r=new l;let n=0;if(e.length>=1){const o=e[e.length-1];typeof o=="boolean"&&(Ue().enableLog(o),n++)}if(e.length-n===2)if(typeof e[0]=="string")typeof e[1]=="string"?await r.initWithFile(e[0].toString(),e[1].toString()):await r.initWithAdapter(e[0].toString(),e[1],e[2]===!0);else{if(typeof e[1]=="string")throw new Error("Invalid parameters for enforcer.");await r.initWithModelAndAdapter(e[0],e[1])}else if(e.length-n===1)typeof e[0]=="string"?await r.initWithFile(e[0],""):await r.initWithModelAndAdapter(e[0]);else if(e.length===n)await r.initWithFile("","");else throw new Error("Invalid parameters for enforcer.");return r}async function rn(...l){return Yi(Qi,...l)}var Fe={},Ct;function Xi(){if(Ct)return Fe;Ct=1;var l=Fe&&Fe.__classPrivateFieldGet||function(o,c,a,h){if(a==="a"&&!h)throw new TypeError("Private accessor was defined without a getter");if(typeof c=="function"?o!==c||!h:!c.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?h:a==="a"?h.call(o):h?h.value:c.get(o)},e=Fe&&Fe.__classPrivateFieldSet||function(o,c,a,h,p){if(h==="m")throw new TypeError("Private method is not writable");if(h==="a"&&!p)throw new TypeError("Private accessor was defined without a setter");if(typeof c=="function"?o!==c||!p:!c.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return h==="a"?p.call(o,a):p?p.value=a:c.set(o,a),a},t,r;Object.defineProperty(Fe,"__esModule",{value:!0});let n=class{constructor(){t.set(this,!1),r.set(this,new Set)}get acquired(){return l(this,t,"f")}acquireAsync({timeout:c}={}){if(!l(this,t,"f"))return e(this,t,!0,"f"),Promise.resolve();if(c==null)return new Promise(p=>{l(this,r,"f").add(p)});let a,h;return Promise.race([new Promise(p=>{a=()=>{clearTimeout(h),p()},l(this,r,"f").add(a)}),new Promise((p,g)=>{h=setTimeout(()=>{l(this,r,"f").delete(a),g(new Error("Timed out waiting for lock"))},c)})])}tryAcquire(){return l(this,t,"f")?!1:(e(this,t,!0,"f"),!0)}release(){if(!l(this,t,"f"))throw new Error("Cannot release an unacquired lock");if(l(this,r,"f").size>0){const[c]=l(this,r,"f");l(this,r,"f").delete(c),c()}else e(this,t,!1,"f")}};return Fe.default=n,t=new WeakMap,r=new WeakMap,Fe}Xi();export{xi as S,Li as _,rn as a,tn as n};
//# sourceMappingURL=casbin-vendor-NoWOyWiA.js.map
